import{P as u,w as ue,r as o,c9 as Ae,ci as V,j as l,cj as ot,d as e,ck as De,at as lt,l as x,k as y,aw as $,q as E,c2 as Ee,f as S,bx as rt,D as le,ch as ie,G,R as te,B as ce,ap as Se,d0 as P,F as ne,dc as J,y as we,a as de,bE as ge,b9 as Q,c7 as K,s as We,cM as fe,L as ct,n as be,o as Le,p as U,K as ve,m as me,aG as oe,bm as Oe,bn as Re,bo as Pe,a_ as dt,br as mt,b8 as ht,dd as pt,aZ as ut,cF as Te,c as gt,S as ft}from"./app-f8174623.js";import{u as ae}from"./use-search-params-1929f833.js";import{M as bt}from"./mail-composer-66a6aae9.js";import"./quill-editor-ab086f5b.js";import{m as xt,D as Z,r as Fe,L as Be,F as ze,d as Ne}from"./mail-c9c49be3.js";import{A as he}from"./Attachment01-90016649.js";import{P as Ie}from"./Plus-bd2ccf65.js";import{S as ke}from"./Star01-11329254.js";import{g as yt}from"./get-initials-d1c6cec7.js";import{u as _e,P as $e}from"./pagination-0fefb487.js";import{A as Ct}from"./AlertCircle-3057bc38.js";import{S as St}from"./Send01-8115495e.js";import{T as wt}from"./Trash02-5ebfe0d4.js";import{H as vt}from"./Heart-25b96a5d.js";import{L as It}from"./ListSubheader-835d88df.js";import"./isEqual-6c4fc5b8.js";import"./index-84f86229.js";import"./file-dropzone-8fef6c70.js";import"./tslib.es6-af7906ce.js";import"./Upload01-98665f21.js";import"./bytes-to-size-706bbf81.js";import"./LastPage-bc904a95.js";xt(()=>({noBorder:{border:"none"}}));const Ge=a=>{const{maximize:t=!1,message:n="",onClose:i,onMaximize:c,onMessageChange:s,onMinimize:d,onSubjectChange:m,onAttach:g,loading:b,onToChange:w,onDisplayChange:f,onInlineImgsChange:p,inlineImgs:C,handleInlineImgsInit:k,onSubmit:M,open:h=!1,subject:r="",to:v="",toDisplay:O="",toemail:B="",avatar:q="",userinfo:Y}=a,[z,N]=o.useState(Z.EditorState.createEmpty()),X=z.getCurrentContent();Z.convertToRaw(X);const j=Ae(),[W,T]=o.useState();JSON.parse(localStorage.getItem("email"));const L=A=>{g(A)},R=A=>{I(A.getCurrentContent()),N(A),T(Ne(Z.convertToRaw(A.getCurrentContent())))},_=o.useCallback(A=>{m==null||m(A.target.value)},[m]),re=()=>{if(r==""){ie.error("You should input Subject field.");return}M()};if(o.useEffect(()=>{s==null||s(W)},[W]),o.useEffect(()=>{n==""&&N(Z.EditorState.createEmpty())},[n]),!h)return null;const I=async A=>{A.getBlockMap().forEach(H=>{H.findEntityRanges(F=>{const ee=F.getEntity();return ee!==null&&A.getEntity(ee).getType()==="IMAGE"},async(F,ee)=>{const pe=A.getBlockForKey(H.getKey()).getEntityAt(F),se=A.getEntity(pe).getData();C.includes(se.src)||(p(se.src),se.src.includes("blob:http")&&axios({method:"get",url:se.src,responseType:"blob"}).then(function(st){var ye=new FileReader;ye.readAsDataURL(st.data),ye.onloadend=function(){var it=ye.result;axios.post("/api/upload_inline",{uri:se.src.split("/")[3],data:it}).then(Me=>{p(se.src+"."+Me.data)}).catch(Me=>{})}}))})})},D=A=>{const H={file:A,localsrc:URL.createObjectURL(A)};return new Promise((F,ee)=>{F({data:{link:H.localsrc}})})};return V(".rdw-remove-wrapper").on("click",function(){j.handleOpen()}),V(".suggestion input").on("focus",function(){V("#suggestion")[0].style.display="none"}),l(ot,{children:[e(De,{open:t}),l(lt,{sx:{bottom:"10%",display:"flex",flexDirection:"column",height:"80%",outline:"none",position:"fixed",left:"5%",width:"90%",zIndex:1200,overflow:"hidden"},elevation:12,children:[l(x,{sx:{alignItems:"center",display:"flex",px:2,py:1},children:[e(y,{variant:"h6",children:"Default Template"}),e(x,{sx:{flexGrow:1}}),e($,{onClick:i,children:e(E,{children:e(Ee,{})})})]}),e(S,{alignItems:"flex-start",direction:{xs:"column",sm:"row"},justifyContent:"space-between",children:l(S,{justifyContent:"flex-start",sx:{width:"100%"},children:[e(S,{alignItems:"center",direction:"row",spacing:1,sx:{py:2,borderBottom:1,borderTop:1,borderColor:"divider"},children:e(y,{sx:{mx:2},children:"To"})}),l(S,{alignItems:"center",direction:"row",spacing:1,sx:{py:2,borderBottom:1,borderColor:"divider"},children:[e(y,{sx:{mx:2},children:"Subject"}),e(rt,{disableUnderline:!0,fullWidth:!0,onChange:_,placeholder:"Input Subject",value:r})]})]})}),e(Fe.Editor,{editorState:z,wrapperClassName:"wrapper-class",editorClassName:"editor-class",toolbarClassName:"toolbar-class",onEditorStateChange:R,toolbar:{options:["image","link","emoji","remove"],link:{options:["link"],link:{icon:"/assets/icons/link.png"}},emoji:{icon:"/assets/icons/smile.png"},image:{icon:"/assets/icons/image.png",uploadCallback:D,previewImage:!0},remove:{icon:"/assets/icons/attach.png",title:"Attach"}}}),e(le,{}),l(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,sx:{p:2,mb:2},children:[e(S,{alignItems:"center",direction:"row",spacing:1,sx:{ml:27}}),e("div",{children:e(Be,{loading:b,loadingPosition:"center",variant:"contained",onClick:re,children:"Save Template"})})]}),e(ze,{onClose:j.handleClose,open:j.open,onUpgrade:L})]})]})};Ge.propTypes={maximize:u.bool,message:u.string,onClose:u.func,onMaximize:u.func,onMessageChange:u.func,onMinimize:u.func,onSubjectChange:u.func,onToChange:u.func,open:u.bool,subject:u.string,to:u.string};const kt=a=>({userinfo:a.profile.userinfo}),Mt=ue(kt)(Ge),Ue=a=>{const{attachments:t=[]}=a,n=t.length,i=()=>{let s=V(".download-link").length;for(let d=0;d<s;d++)V(".download-link")[d].click()},c=(s,d=2)=>{if(!Number(s))return"0 Bytes";const m=1024,g=d<0?0:d,b=["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],w=Math.floor(Math.log(s)/Math.log(m));return`${parseFloat((s/Math.pow(m,w)).toFixed(g))} ${b[w]}`};return l(S,{spacing:2,children:[l(y,{variant:"h6",children:[n," Attachments"]}),e(S,{alignItems:"flex-start",direction:"row",spacing:2,flexWrap:"wrap",children:t.map(s=>l(S,{alignItems:"center",direction:"row",spacing:1,sx:{alignItems:"center",cursor:"pointer",display:"flex"},children:[s.type.split("/")[0]=="image"&&e(G,{component:te,src:"data:image/png;base64,"+s.attachment,href:"data:"+s.type+";base64,"+s.attachment,download:s.name,variant:"rounded"}),s.type.split("/")[0]!="image"&&e(G,{variant:"rounded",sx:{backgroundColor:"primary.light",borderRadius:"50%"},component:te,href:"data:"+s.type+";base64,"+s.attachment,download:s.name,children:e(he,{})}),l("div",{children:[e(y,{className:"download-link",noWrap:!0,variant:"subtitle2",component:te,href:"data:"+s.type+";base64,"+s.attachment,download:s.name,children:s.name}),e(y,{color:"text.secondary",variant:"body2",children:c(s.size)})]})]},s.id))}),e("div",{children:e(ce,{color:"primary",size:"small",onClick:i,children:"Download all"})})]})};Ue.propTypes={attachments:u.array};Se("div")(({theme:a})=>({color:a.palette.text.primary,fontFamily:a.typography.body1.fontFamily,"& > p":{fontSize:14,lineHeight:a.typography.body1.lineHeight,marginBottom:a.spacing(2)}}));const qe=a=>{const{message:t=""}=a;return e("div",{dangerouslySetInnerHTML:{__html:t}})};qe.propTypes={message:u.string};const Tt=a=>{const{from:t,to:n,subject:i,userinfo:c}=a,s=o.useRef(null),[d,m]=o.useState(Z.EditorState.createEmpty()),g=d.getCurrentContent();Z.convertToRaw(g);const b=Ae(),[w,f]=o.useState(),p=JSON.parse(localStorage.getItem("email")),[C,k]=o.useState(""),[M,h]=o.useState([]),[r,v]=o.useState(new FormData),[O,B]=o.useState(!1),q=P(),Y=T=>{N(T.getCurrentContent()),m(T),f(Ne(Z.convertToRaw(T.getCurrentContent())))},z=ae().get("label")||"inbox";o.useEffect(()=>{k(w)},[w]),o.useEffect(()=>{C==""&&m(Z.EditorState.createEmpty())},[C]);const N=async T=>{T.getBlockMap().forEach(L=>{L.findEntityRanges(R=>{const _=R.getEntity();return _!==null&&T.getEntity(_).getType()==="IMAGE"},async(R,_)=>{const re=T.getBlockForKey(L.getKey()).getEntityAt(R),D=T.getEntity(re).getData();if(M.includes(D.src))return;let A=M;A.push(D.src),h(A),D.src.includes("blob:http")&&axios({method:"get",url:D.src,responseType:"blob"}).then(function(H){var F=new FileReader;F.readAsDataURL(H.data),F.onloadend=function(){var ee=F.result;axios.post("/api/upload_inline",{uri:D.src.split("/")[3],data:ee}).then(pe=>{let xe=M;xe.push(D.src+"."+pe.data),h(xe)}).catch(pe=>{})}})})})},X=T=>{const L={file:T,localsrc:URL.createObjectURL(T)};return new Promise((R,_)=>{R({data:{link:L.localsrc}})})},j=T=>{v(T)},W=()=>{if(c.is_admin!="1"){if(c.paid=="1"&&c.message_cnt>=50){ie.error(`You are trying to send 51th message this month.
 Please upgrade your membership. 
 `+c.time+"days left by renewal date.");return}else if(c.paid=="0"&&c.message_cnt>=5){ie.error(`Trial user cannot send over 5 messages .
 Please upgrade your membership.`);return}}if(B(!0),z=="inbox")r.append("to",t.email);else{let T="";n[0].name.map((L,R)=>{T+=R==n[0].name.length-1?L.mail:L.mail+", "}),r.append("to",T)}r.append("subject",i),r.append("message",C),r.append("email",p),r.append("inlineImgs",M),axios.post("/api/send_mail",r,{}).then(T=>{ie.success("Message Sent Successfuly."),q(J.getEmails({label:z,email:JSON.parse(localStorage.getItem("email"))})),q(we({email:JSON.parse(localStorage.getItem("email"))})),B(!1),k(""),h([]),v(new FormData)}).catch(T=>{})};return V(".rdw-remove-wrapper").on("click",function(){b.handleOpen()}),l(ne,{children:[e(x,{sx:{p:3},...a,children:e(S,{alignItems:"flex-start",direction:"row",spacing:2,children:l(x,{sx:{flexGrow:1},children:[e(Fe.Editor,{editorState:d,wrapperClassName:"wrapper-class reply-wrapper",editorClassName:"editor-class reply-class",toolbarClassName:"toolbar-class",onEditorStateChange:Y,toolbar:{options:["image","link","emoji","remove"],link:{options:["link"],link:{icon:"/assets/icons/link.png"}},emoji:{icon:"/assets/icons/smile.png"},image:{icon:"/assets/icons/image.png",uploadCallback:X,previewImage:!0},remove:{icon:"/assets/icons/attach.png",title:"Attach"}}}),l(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,sx:{p:2,mb:2},children:[e(S,{alignItems:"center",direction:"row",spacing:1,sx:{ml:17}}),e("div",{children:e(Be,{loading:O,loadingPosition:"center",variant:"contained",onClick:W,children:"Reply"})})]}),e(ze,{onClose:b.handleClose,open:b.open,onUpgrade:j})]})})}),e("input",{hidden:!0,ref:s,type:"file"})]})},jt=a=>({userinfo:a.profile.userinfo}),At=ue(jt)(Tt),He=a=>{const{backHref:t,uid:n,createdAt:i,from:c,to:s,folder:d="inbox",onSidebarToggle:m,currentLabelId:g="inbox"}=a,b=de(),w=ge(h=>h.breakpoints.up("md")),f=Q(new Date(i),"MMMM d yyyy, h:mm:ss a"),[p,C]=o.useState(!1),k=K(h=>h.mail.labels),M=h=>{C(!0),axios.post("/api/del_mail",{uid:h,label:d,email:JSON.parse(localStorage.getItem("email"))}).then(r=>{C(!1),g=="inbox"&&b.push("/dashboard/mail"),g=="sent"&&b.push("/dashboard/mail?label=sent"),g=="favorites"&&b.push("/dashboard/mail?label=favorites")}).catch(r=>{})};return console.log(s),l("div",{children:[l(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{p:2},children:[p==!0?l(x,{sx:{display:"flex",textAlign:"center"},children:[e(We,{}),e(y,{sx:{display:"inline",fontSize:18,fontWeight:700,p:1},children:"Removing..."})]}):e(ne,{}),l("div",{children:[e($,{onClick:m,children:e(E,{children:e(fe,{})})}),e(y,{sx:{display:"inline",fontSize:18,fontWeight:700},children:g==null?"Inbox":k.map(h=>{if(h.id==g)return h.name})})]})]}),e(le,{}),l(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{p:3},children:[d=="inbox"?l(S,{alignItems:"center",direction:"row",spacing:2,children:[e(G,{src:`https://ui-avatars.com/api/?name=${c.email}&background=2970FF&color=fff&rounded=true`}),l("div",{children:[l(y,{component:"span",variant:"subtitle2",children:["From: ",c.name]})," ",e(y,{color:"text.secondary",variant:"subtitle2",children:"To: Me"})]})]}):l(S,{alignItems:"center",direction:"row",spacing:2,children:[e(G,{src:`https://ui-avatars.com/api/?name=${c.email}&background=2970FF&color=fff&rounded=true`}),l("div",{children:[l(y,{component:"span",variant:"subtitle2",children:["From: ",c.name]})," ",l(y,{color:"text.secondary",variant:"subtitle2",children:["To:"," ",s[0].name.map((h,r)=>e(ct,{color:"inherit",children:r==s[0].name.length-1?h.mail:h.mail+", "},h.mail))]})]})]}),e(S,{alignItems:"center",direction:"row",spacing:1,children:w&&l(ne,{children:[f&&e(y,{color:"text.secondary",noWrap:!0,variant:"caption",children:f}),e(be,{title:"Delete",children:e($,{onClick:()=>M(n),children:e("img",{src:"/assets/icons/trash.png",width:15,height:15})})})]})})]})]})};He.propTypes={backHref:u.string.isRequired,from:u.object.isRequired,to:u.array.isRequired};const Dt=a=>(P(),K(n=>n.mail.emails.byId[a])),Je=a=>{const{emailId:t,currentLabelId:n,onSidebarToggle:i}=a,c=Dt(t),s=Le(),d=n&&n!=="inbox"?U.dashboard.mail+`?label=${n}`:U.dashboard.mail;if(!c)return s(d),null;const m=!!c.message,g=c.attachments&&c.attachments.length>0;return l(S,{sx:{flexGrow:1,height:"100%",overflowY:"auto"},children:[e(He,{uid:t,backHref:d,createdAt:new Date(c.createdAt),currentLabelId:n,folder:c.realfolder,from:c.from,onSidebarToggle:i,to:c.to}),l(x,{sx:{flexGrow:1,px:3,py:6},children:[e(y,{variant:"h3",children:c.subject}),l(S,{sx:{mt:2},spacing:6,children:[m&&e(qe,{message:c.message}),g&&e(Ue,{attachments:c.attachments})]})]}),e(At,{from:c.from,to:c.to,subject:c.subject})]})};Je.propTypes={emailId:u.string.isRequired,currentLabelId:u.string};const Ke=a=>{const{attachments:t}=a,n=t.split(",").length,i=()=>{let c=V(".download-link").length;for(let s=0;s<c;s++)V(".download-link")[s].click()};return l(S,{spacing:2,children:[l(y,{variant:"h6",children:[n," Attachments"]}),e(S,{alignItems:"flex-start",direction:"row",spacing:2,flexWrap:"wrap",children:t.split(",").map((c,s)=>l(S,{alignItems:"center",direction:"row",spacing:1,sx:{alignItems:"center",cursor:"pointer",display:"flex"},children:[e(G,{variant:"rounded",sx:{backgroundColor:"primary.light",borderRadius:"50%"},component:te,href:"http://localhost/tmpfiles/"+c,download:c,target:"_blank",children:e(he,{})}),e("div",{children:e(y,{className:"download-link",component:te,noWrap:!0,variant:"subtitle2",href:"http://localhost/tmpfiles/"+c,download:c,target:"_blank",children:c})})]},s))}),e("div",{children:e(ce,{color:"primary",size:"small",onClick:i,children:"Download all"})})]})};Ke.propTypes={attachments:u.string};Se("div")(({theme:a})=>({color:a.palette.text.primary,fontFamily:a.typography.body1.fontFamily,"& > p":{fontSize:14,lineHeight:a.typography.body1.lineHeight,marginBottom:a.spacing(2)}}));const Ze=a=>{const{message:t=""}=a;return e("div",{dangerouslySetInnerHTML:{__html:t}})};Ze.propTypes={message:u.string};const Ve=a=>{const{backHref:t,tmpmail:n,createdAt:i,userinfo:c,onSidebarToggle:s,currentLabelId:d="inbox"}=a,m=de(),g=ge(p=>p.breakpoints.up("md")),b=Q(new Date(i),"MMMM d yyyy, h:mm:ss a"),w=K(p=>p.mail.labels),f=p=>{axios.post("/api/del_tmpmail",{uid:p,email:JSON.parse(localStorage.getItem("email"))}).then(C=>{m.push("/dashboard/mail?label=template")}).catch(C=>{})};return l("div",{children:[e(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{p:2},children:l("div",{children:[e($,{onClick:s,children:e(E,{children:e(fe,{})})}),e(y,{sx:{display:"inline",fontSize:18,fontWeight:700},children:d==null?"Inbox":w.map(p=>{if(p.id==d)return p.name})})]})}),e(le,{}),l(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{p:3},children:[l(S,{alignItems:"center",direction:"row",spacing:2,children:[e(G,{src:c.avatar?c.avatar:`https://ui-avatars.com/api/?name=${c.fullname}&background=2970FF&color=fff&rounded=true`}),e("div",{children:e(y,{component:"span",variant:"subtitle2",children:c.fullname})})]}),e(S,{alignItems:"center",direction:"row",spacing:1,children:g&&l(ne,{children:[b&&e(y,{color:"text.secondary",noWrap:!0,variant:"caption",children:b}),e(be,{title:"Delete",children:e($,{onClick:()=>f(n.id),children:e("img",{src:"/assets/icons/trash.png",width:15,height:15})})})]})})]})]})};Ve.propTypes={backHref:u.string.isRequired};const Et=a=>(P(),K(n=>n.mail.tmpmails.filter(i=>i.id==a)[0])),Qe=a=>{const{emailId:t,currentLabelId:n,onSidebarToggle:i,userinfo:c}=a,s=Et(t),d=Le(),m=n&&n!=="inbox"?U.dashboard.mail+`?label=${n}`:U.dashboard.mail;if(!s)return d(m),null;const g=!!s.message,b=s.files.split(",").length>0;return l(S,{sx:{flexGrow:1,height:"100%",overflowY:"auto"},children:[e(Ve,{tmpmail:s,backHref:m,createdAt:new Date(s.created_at),currentLabelId:n,onSidebarToggle:i,userinfo:c}),l(x,{sx:{flexGrow:1,px:3,py:6},children:[e(y,{variant:"h3",children:s.subject}),l(S,{sx:{mt:2},spacing:6,children:[g&&e(Ze,{message:s.message}),b&&e(Ke,{attachments:s.files})]})]})]})};Qe.propTypes={emailId:u.string.isRequired,currentLabelId:u.string};const je=Se("div",{shouldForwardProp:a=>a!=="open"})(({theme:a,open:t})=>({flexGrow:1,overflow:"hidden",[a.breakpoints.up("md")]:{marginLeft:-280},transition:a.transitions.create("margin",{easing:a.transitions.easing.sharp,duration:a.transitions.duration.leavingScreen}),...t&&{[a.breakpoints.up("md")]:{marginLeft:0},transition:a.transitions.create("margin",{easing:a.transitions.easing.easeOut,duration:a.transitions.duration.enteringScreen})}}));var Wt=function(t){return e("svg",ve({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:e("path",{fill:"#fff",fillOpacity:.01,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 7.8c0-1.6802 0-2.5202.327-3.162a3 3 0 0 1 1.311-1.311C7.2798 3 8.1198 3 9.8 3h4.4c1.6802 0 2.5202 0 3.162.327a2.9997 2.9997 0 0 1 1.311 1.311C19 5.2798 19 6.1198 19 7.8V21l-7-4-7 4V7.8Z"})}))};const Ye=a=>{const{email:t,onDeselect:n,onSelect:i,onCompose:c,selected:s,href:d,...m}=a,g=P(),w=ae().get("label")||void 0,f=o.useCallback(r=>{r.target.checked?i==null||i():n==null||n()},[i,n]),p=Q(new Date(t.createdAt),"MMM dd"),C=Q(new Date(t.createdAt),"MMM dd, hh:mm aa"),k=!!(t.attachments&&t.attachments.length>0),M=!!(t.attachments&&t.attachments.length>1);de();const h=(r,v,O,B)=>{axios.post("/api/update_fav",{uid:v,flag:r,email:JSON.parse(localStorage.getItem("email")),label:O}).then(q=>{g(J.getEmails({label:B,email:JSON.parse(localStorage.getItem("email"))}))}).catch(q=>{})};return l(x,{sx:{alignItems:"center",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider",display:"flex",p:2,...!t.isUnread&&{position:"relative","&:before":{backgroundColor:"primary.main",content:'" "',height:"100%",left:0,position:"absolute",top:0,width:4},"& $name, & $subject":{fontWeight:600}},...s&&{backgroundColor:"primary.lightest"},...!s&&{"&:hover":{backgroundColor:"action.hover"}}},...m,children:[l(x,{sx:{alignItems:"center",display:{md:"flex",xs:"none"},mr:1},children:[e(me,{checked:s,onChange:f}),e(be,{title:"Starred",children:e($,{onClick:()=>h(t.favorite,t.id,t.realfolder,t.folder),children:e(E,{sx:{...t.favorite&&{color:"warning.main","& path":{fill:r=>r.palette.warning.main,fillOpacity:1}}},children:e(ke,{})})})})]}),l(x,{component:te,href:d,sx:{alignItems:"center",cursor:"pointer",display:"contents",flexGrow:1,flexWrap:{xs:"wrap",md:"wrap"},minWidth:1,textDecoration:"none"},children:[t.realfolder=="inbox"?l(x,{sx:{alignItems:"center",display:"flex"},children:[e(G,{src:`https://ui-avatars.com/api/?name=${t.from.email}&background=2970FF&color=fff&rounded=true`}),e(y,{color:"text.primary",sx:{width:120,ml:2,...!t.isUnread&&{fontWeight:600}},noWrap:!0,variant:"body2",children:t.from.email})]}):l(x,{sx:{alignItems:"center",display:"flex"},children:[e(G,{src:`https://ui-avatars.com/api/?name=${t.to[0].name[0].mail}&background=2970FF&color=fff&rounded=true`}),e(y,{color:"text.primary",sx:{width:120,ml:2,...!t.isUnread&&{fontWeight:600}},noWrap:!0,variant:"body2",children:t.to[0].name.map(r=>r.mail)})]}),l(x,{sx:{ml:{xs:0,md:2},my:{xs:2,md:0},overflow:"hidden",width:"-webkit-fill-available"},children:[l(x,{sx:{alignItems:"center",display:"flex",maxWidth:800,width:"100%"},children:[t.isUnread.seen=="Seen"?e(y,{color:"text.primary",sx:{fontWeight:400,minWidth:100,maxWidth:400,mr:1},noWrap:!0,variant:"body2",children:t.subject}):e(y,{color:"text.primary",sx:{fontWeight:700,minWidth:100,maxWidth:400,mr:1},noWrap:!0,variant:"body2",children:t.subject}),e(y,{className:"inline-item",color:"text.secondary",noWrap:!0,variant:"body2",children:e("div",{dangerouslySetInnerHTML:{__html:t.message}})})]}),k&&l(x,{sx:{mt:1,maxWidth:800},children:[e(oe,{icon:e(E,{children:e(he,{})}),label:t.attachments[0].name,size:"small"}),M&&e(oe,{label:"+"+(t.attachments.length-1).toString(),size:"small",sx:{ml:1}})]})]}),e(x,{sx:{margin:"auto"},children:e(y,{color:"text.secondary",variant:"caption",alignItems:"center",sx:{display:"block",textAlign:{xs:"left",md:"right"},whiteSpace:"nowrap",width:"100%"},children:w&&w.search("template")>=0?"Last used-"+C:p})})]})]})};Ye.propTypes={email:u.object.isRequired,href:u.string.isRequired,onDeselect:u.func,onSelect:u.func,selected:u.bool.isRequired};const Xe=a=>{const{email:t,onDeselect:n,onSelect:i,onCompose:c,selected:s,href:d,...m}=a,b=ae().get("label")||void 0,w=o.useCallback(M=>{M.target.checked?i==null||i():n==null||n()},[i,n]),f=Q(new Date(t.createdAt),"MMM dd"),p=Q(new Date(t.createdAt),"MMM dd, hh:mm aa"),C=!!(t.attachments&&t.attachments.length>0),k=!!(t.attachments&&t.attachments.length>1);return l(x,{sx:{alignItems:"center",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider",display:"flex",p:2,...!t.isUnread&&{position:"relative","&:before":{backgroundColor:"primary.main",content:'" "',height:"100%",left:0,position:"absolute",top:0,width:4},"& $name, & $subject":{fontWeight:600}},...s&&{backgroundColor:"primary.lightest"},...!s&&{"&:hover":{backgroundColor:"action.hover"}}},...m,children:[l(x,{sx:{alignItems:"center",display:{md:"flex",xs:"none"},mr:1},children:[e(me,{checked:s,onChange:w}),e(be,{title:"Starred",children:e($,{children:e(E,{sx:{...t.isStarred&&{color:"warning.main","& path":{fill:M=>M.palette.warning.main,fillOpacity:1}}},children:e(ke,{})})})})]}),l(x,{sx:{alignItems:"center",cursor:"pointer",display:"flex",flexGrow:1,flexWrap:{xs:"wrap",md:"wrap"},minWidth:1,textDecoration:"none"},children:[l(x,{sx:{alignItems:"center",display:"flex"},children:[e(G,{src:t.from.avatar||void 0,children:yt(t.from.name)}),e(y,{color:"text.primary",sx:{width:120,ml:2,...!t.isUnread&&{fontWeight:600}},noWrap:!0,variant:"body2",children:t.from.name})]}),l(x,{sx:{ml:{xs:0,md:2},my:{xs:2,md:0},overflow:"hidden",width:"fit-content"},children:[l(x,{sx:{alignItems:"center",display:"flex",maxWidth:800,width:"100%"},children:[e(y,{color:"text.primary",sx:{fontWeight:600,minWidth:100,maxWidth:400,mr:1},noWrap:!0,variant:"body2",children:t.subject}),l(y,{color:"text.secondary",noWrap:!0,variant:"body2",children:["—",t.message]})]}),C&&l(x,{sx:{mt:1,maxWidth:800},children:[e(oe,{icon:e(E,{children:e(he,{})}),label:t.attachments[0].name,size:"small"}),k&&e(oe,{label:"+1",size:"small",sx:{ml:1}})]})]}),e(x,{children:e(y,{color:"text.secondary",variant:"caption",alignItems:"center",sx:{display:"block",textAlign:{xs:"left",md:"right"},whiteSpace:"nowrap",width:"100%"},children:b&&b.search("template")>=0?"Last used-"+p:f})})]})]})};Xe.propTypes={email:u.object.isRequired,href:u.string.isRequired,onDeselect:u.func,onSelect:u.func,selected:u.bool.isRequired};const Lt=a=>{const t=P(),{emails:n}=K(i=>i.mail);return o.useEffect(()=>{t(J.getEmails({label:a??"inbox",email:JSON.parse(localStorage.getItem("email"))}))},[a]),n},Ot=a=>{const[t,n]=o.useState([]);o.useEffect(()=>{n([])},[a]);const i=o.useCallback(()=>{n([...a])},[a]),c=o.useCallback(m=>{n(g=>g.includes(m)?g:[...g,m])},[]),s=o.useCallback(()=>{n([])},[]),d=o.useCallback(m=>{n(g=>g.filter(b=>b!==m))},[]);return{handleDeselectAll:s,handleDeselectOne:d,handleSelectAll:i,handleSelectOne:c,selected:t}},et=a=>{const{currentLabelId:t,disCount:n,onSidebarToggle:i,onCompose:c,...s}=a,d=Lt(t),[m,g]=o.useState(!0),b=P(),w=K(I=>I.mail.labels),[f,p]=o.useState(0);o.useState([]),o.useState([]),o.useEffect(()=>{p(1),g(!0)},[t]);const{handleDeselectAll:C,handleDeselectOne:k,handleSelectAll:M,handleSelectOne:h,selected:r}=Ot(d.allIds),v=o.useCallback(I=>{I.target.checked?M():C()},[M,C]),O=I=>{I.isUnread.seen||axios.post("/api/unread_set",{uid:I.id,email:JSON.parse(localStorage.getItem("email"))}).then(D=>{b(J.getEmails({label:"inbox",email:JSON.parse(localStorage.getItem("email"))})),b(J.getCntEmails({label:"inbox",email:JSON.parse(localStorage.getItem("email"))}))}).catch(D=>{})},B=r.length===d.allIds.length,q=r.length>0&&r.length<d.allIds.length,Y=d.allIds.length>0,[z,N]=o.useState(d.allIds);o.useEffect(()=>{f==1&&g(!1),p(f+1),f>=2&&p(0),N(d.allIds)},[d]);const[X,j]=o.useState(1),W=10,T=Math.ceil(z.length/W),L=_e(z,W),R=(I,D)=>{j(D),L.jump(D)},_=o.useRef(null),re=o.useCallback(I=>{var H;I.preventDefault();const D=((H=_.current)==null?void 0:H.value)||"";let A=d.allIds.filter(F=>!(typeof D<"u"&&D!==""&&!(d.byId[F].subject||"").toLowerCase().includes(D.toLowerCase())));N(A)},[d]);return l(S,{sx:{height:"100%",overflowY:"auto"},...s,children:[e(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{p:2},children:l("div",{children:[e($,{onClick:i,children:e(E,{children:e(fe,{})})}),e(y,{sx:{display:"inline",fontSize:18,fontWeight:700},children:t==null?"Inbox":w.map(I=>{if(I.id==t)return I.name})})]})}),e(le,{}),m==!0?l(De,{open:m,onClick:I=>I.preventDefault(),sx:{color:"#fff",zIndex:I=>I.zIndex.drawer+1},children:[e(We,{color:"inherit"}),e(y,{sx:{display:"inline",fontSize:18,fontWeight:700,p:1},children:"Loading..."})]}):Y?l(ne,{children:[l(x,{sx:{alignItems:"center",borderBottomColor:"divider",borderBottomStyle:"solid",borderBottomWidth:1,display:{xs:"none",md:"flex"},p:2},children:[e(me,{checked:B,indeterminate:q,onChange:v}),e(y,{variant:"subtitle2",children:"Select all"}),e(x,{sx:{flexGrow:1}}),l(S,{alignItems:"center",direction:"row",spacing:1,children:[t&&t.search("template")>=0?e(ce,{onClick:c,startIcon:e(E,{children:e(Ie,{})}),variant:"contained",children:"New Template"}):"",e(x,{component:"form",onSubmit:re,sx:{flexGrow:1},children:e(Oe,{fullWidth:!0,inputProps:{ref:_},placeholder:"Search email",size:"small",startAdornment:e(Re,{position:"start",children:e(E,{children:e(Pe,{})})}),sx:{width:200}})}),e($e,{count:T,page:X,variant:"outlined",shape:"rounded",onChange:R})]})]}),e("div",{children:L.currentData().map(I=>{const D=r.includes(I),A=t&&t!=="inbox"?U.dashboard.mail+`?emailId=${I}&label=${t}`:U.dashboard.mail+`?emailId=${I}`;return t&&t.search("template")>=0?e(Xe,{email:d.byId[I],href:A,onCompose:c,onClick:c,onDeselect:()=>k(I),onSelect:()=>h(I),selected:D},I):d.byId[I]&&e(Ye,{email:d.byId[I],href:A,onClick:()=>O(d.byId[I]),onCompose:c,onDeselect:()=>k(I),onSelect:()=>h(I),selected:D},I)})})]}):l(S,{alignItems:"center",justifyContent:"center",spacing:2,sx:{flexGrow:1,p:2},children:[e(x,{component:"img",src:"/assets/errors/error-404.png",sx:{height:"auto",maxWidth:120}}),e(y,{color:"text.secondary",variant:"h5",children:"There are no emails"})]})]})};et.propTypes={currentLabelId:u.string,onSidebarToggle:u.func};const tt=a=>{const{email:t,onDeselect:n,onSelect:i,onCompose:c,userinfo:s,selected:d,href:m,...g}=a;P();const w=ae().get("label")||void 0,f=o.useCallback(k=>{k.target.checked?i==null||i():n==null||n()},[i,n]),p=Q(new Date(t.created_at),"MMM dd"),C=Q(new Date(t.created_at),"MMM dd, hh:mm aa");return t.attachments&&t.attachments.length>0,t.attachments&&t.attachments.length>1,de(),l(x,{sx:{alignItems:"center",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider",display:"flex",p:2,...d&&{backgroundColor:"primary.lightest"},...!d&&{"&:hover":{backgroundColor:"action.hover"}}},...g,children:[e(x,{sx:{alignItems:"center",display:{md:"flex",xs:"none"},mr:1},children:e(me,{checked:d,onChange:f})}),l(x,{component:te,href:m,sx:{alignItems:"center",cursor:"pointer",display:"contents",flexGrow:1,flexWrap:{xs:"wrap",md:"wrap"},minWidth:1,textDecoration:"none"},children:[l(x,{sx:{alignItems:"center",display:"flex"},children:[e(G,{src:s.avatar?s.avatar:`https://ui-avatars.com/api/?name=${s.fullname}&background=2970FF&color=fff&rounded=true`}),e(y,{color:"text.primary",sx:{width:120,ml:2},noWrap:!0,variant:"body2",children:s.fullname})]}),l(x,{sx:{ml:{xs:0,md:2},my:{xs:2,md:0},overflow:"hidden",width:"-webkit-fill-available"},children:[e(x,{sx:{alignItems:"center",display:"flex",maxWidth:800,width:"100%"},children:e(y,{color:"text.primary",sx:{fontWeight:400,minWidth:100,maxWidth:400,mr:1},noWrap:!0,variant:"body2",children:t.subject})}),t.files!=""&&l(x,{sx:{mt:1,maxWidth:800},children:[e(oe,{icon:e(E,{children:e(he,{})}),label:t.files.split(",")[0],size:"small"}),t.files.split(",")[1]&&t.files.split(",")[1]!=""&&e(oe,{label:"+"+(t.files.split(",").length-1).toString(),size:"small",sx:{ml:1}})]})]}),e(x,{sx:{margin:"auto"},children:e(y,{color:"text.secondary",variant:"caption",alignItems:"center",sx:{display:"block",textAlign:{xs:"left",md:"right"},whiteSpace:"nowrap",width:"100%"},children:w&&w.search("template")>=0?"Last used-"+C:p})})]})]})};tt.propTypes={email:u.object.isRequired,href:u.string.isRequired,onDeselect:u.func,onSelect:u.func,selected:u.bool.isRequired};const Rt=a=>({userinfo:a.profile.userinfo}),Pt=ue(Rt)(tt),Ft=a=>{const t=P(),{tmpmails:n}=K(i=>i.mail);return o.useEffect(()=>{t(J.getTmpEmails({label:"template",email:JSON.parse(localStorage.getItem("email"))}))},[a]),n},Bt=a=>{const[t,n]=o.useState([]);o.useEffect(()=>{n([])},[a]);const i=o.useCallback(()=>{n([...a])},[a]),c=o.useCallback(m=>{n(g=>g.includes(m)?g:[...g,m])},[]),s=o.useCallback(()=>{n([])},[]),d=o.useCallback(m=>{n(g=>g.filter(b=>b!==m))},[]);return{handleDeselectAll:s,handleDeselectOne:d,handleSelectAll:i,handleSelectOne:c,selected:t}},nt=a=>{const{currentLabelId:t,onSidebarToggle:n,onCompose:i,...c}=a,s=Ft(t);P();const d=K(j=>j.mail.labels),{handleDeselectAll:m,handleDeselectOne:g,handleSelectAll:b,handleSelectOne:w,selected:f}=Bt(s),p=o.useCallback(j=>{j.target.checked?b():m()},[b,m]),C=f.length===s.length,k=f.length>0&&f.length<s.length,M=s.length>0,[h,r]=o.useState(s);o.useEffect(()=>{r(s)},[s]);const[v,O]=o.useState(1),B=10,q=Math.ceil(h.length/B),Y=_e(h,B),z=(j,W)=>{O(W),Y.jump(W)},N=o.useRef(null),X=o.useCallback(j=>{var L;j.preventDefault();const W=((L=N.current)==null?void 0:L.value)||"";let T=s.filter(R=>!(typeof W<"u"&&W!==""&&!(R.subject||"").toLowerCase().includes(W.toLowerCase())));r(T)},[s]);return l(S,{sx:{height:"100%",overflowY:"auto"},...c,children:[e(S,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{p:2},children:l("div",{children:[e($,{onClick:n,children:e(E,{children:e(fe,{})})}),e(y,{sx:{display:"inline",fontSize:18,fontWeight:700},children:t==null?"Inbox":d.map(j=>{if(j.id==t)return j.name})})]})}),l(x,{sx:{alignItems:"center",borderBottomColor:"divider",borderBottomStyle:"solid",borderBottomWidth:1,display:{xs:"none",md:"flex"},p:2},children:[e(me,{checked:C,indeterminate:k,onChange:p}),e(y,{variant:"subtitle2",children:"Select all"}),e(x,{sx:{flexGrow:1}}),l(S,{alignItems:"center",direction:"row",spacing:1,children:[e(ce,{onClick:i,startIcon:e(E,{children:e(Ie,{})}),variant:"contained",children:"New Template"}),e(x,{component:"form",onSubmit:X,sx:{flexGrow:1},children:e(Oe,{fullWidth:!0,inputProps:{ref:N},placeholder:"Search email",size:"small",startAdornment:e(Re,{position:"start",children:e(E,{children:e(Pe,{})})}),sx:{width:200}})}),e($e,{count:q,page:v,variant:"outlined",shape:"rounded",onChange:z})]})]}),e(le,{}),M?e(ne,{children:e("div",{children:Y.currentData().map(j=>{const W=f.includes(j),T=t&&t!=="inbox"?U.dashboard.mail+`?emailId=${j.id}&label=${t}`:U.dashboard.mail+`?emailId=${j}`;return e(Pt,{email:j,href:T,onCompose:i,onDeselect:()=>g(j),onSelect:()=>w(j),selected:W},j.id)})})}):l(S,{alignItems:"center",justifyContent:"center",spacing:2,sx:{flexGrow:1,p:2},children:[e(x,{component:"img",src:"/assets/errors/error-404.png",sx:{height:"auto",maxWidth:120}}),e(y,{color:"text.secondary",variant:"h5",children:"There are no templates"})]})]})};nt.propTypes={currentLabelId:u.string,onSidebarToggle:u.func};var zt=function(t){return l("svg",ve({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:[e("path",{fill:"#fff",fillOpacity:.01,d:"M14.7301 4H9.2699c-.9692 0-1.4538 0-1.8816.1476a2.7 2.7 0 0 0-1.0088.6235c-.3234.3166-.54.75-.9735 1.617l-1.95 3.8998c-.17.3401-.255.5102-.315.6885a2.6993 2.6993 0 0 0-.115.4866C3 11.6493 3 11.8395 3 12.2198V14.08c0 1.5121 0 2.2682.2943 2.8458.2588.508.6719.9211 1.18 1.1799.5775.2943 1.3336.2943 2.8457.2943h9.36c1.5121 0 2.2682 0 2.8458-.2943a2.6996 2.6996 0 0 0 1.1799-1.1799C21 16.3482 21 15.5921 21 14.08v-1.8602c0-.3803 0-.5705-.0261-.7568a2.6918 2.6918 0 0 0-.1149-.4866c-.0599-.1783-.145-.3484-.3151-.6885L18.594 6.388c-.4334-.8668-.6501-1.3003-.9735-1.617a2.7 2.7 0 0 0-1.0088-.6234C16.1839 4 15.6993 4 14.7301 4Z"}),e("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.45 11.2h3.0438a1.628 1.628 0 0 1 1.4562.9c.2758.5516.8396.9 1.4562.9h5.1876a1.628 1.628 0 0 0 1.4562-.9 1.628 1.628 0 0 1 1.4562-.9H20.55M9.27 4h5.46c.9692 0 1.4538 0 1.8816.1476a2.7 2.7 0 0 1 1.0088.6235c.3234.3166.5401.75.9735 1.617l1.9499 3.8998c.1701.3401.2552.5102.3151.6885.0533.1583.0918.3212.1149.4866.0261.1863.0261.3765.0261.7568V14.08c0 1.5121 0 2.2682-.2943 2.8458a2.6996 2.6996 0 0 1-1.1799 1.1799c-.5776.2943-1.3337.2943-2.8458.2943H7.32c-1.5121 0-2.2682 0-2.8458-.2943a2.6998 2.6998 0 0 1-1.18-1.1799C3 16.3482 3 15.5921 3 14.08v-1.8602c0-.3803 0-.5705.026-.7568a2.6993 2.6993 0 0 1 .115-.4866c.06-.1783.145-.3484.315-.6885l1.95-3.8999c.4334-.8668.6501-1.3003.9735-1.617a2.7 2.7 0 0 1 1.0088-.6234C7.8161 4 8.3007 4 9.2699 4Z"})]}))},Nt=function(t){return l("svg",ve({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},t,{children:[e("path",{fill:"#fff",fillOpacity:.01,d:"M2.9373 11.9373c-.346-.3459-.5189-.5189-.6426-.7207a2.0013 2.0013 0 0 1-.2394-.5781C2 10.4083 2 10.1637 2 9.6745V5.2c0-1.1201 0-1.6802.218-2.108a2 2 0 0 1 .874-.874C3.5198 2 4.08 2 5.2 2h4.4745c.4892 0 .7338 0 .964.0553.204.049.3991.1298.5781.2394.2018.1237.3748.2966.7207.6426l7.6686 7.6686c1.188 1.188 1.7821 1.7821 2.0046 2.467a2.9996 2.9996 0 0 1 0 1.8541c-.2225.685-.8166 1.2791-2.0046 2.4671l-2.2118 2.2118c-1.188 1.188-1.7821 1.7821-2.4671 2.0046a2.9996 2.9996 0 0 1-1.8541 0c-.6849-.2225-1.279-.8166-2.467-2.0046l-7.6686-7.6686Z"}),e("path",{fill:"#fff",fillOpacity:.01,d:"M8.5 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z"}),e("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 8h.01M2 5.2v4.4745c0 .4892 0 .7338.0553.964.049.204.1298.3991.2394.5781.1237.2018.2966.3748.6426.7207l7.6686 7.6686c1.188 1.188 1.7821 1.7821 2.467 2.0046a2.9996 2.9996 0 0 0 1.8541 0c.685-.2225 1.2791-.8166 2.4671-2.0046l2.2118-2.2118c1.188-1.188 1.7821-1.7821 2.0046-2.4671a2.9996 2.9996 0 0 0 0-1.8541c-.2225-.6849-.8166-1.279-2.0046-2.467l-7.6686-7.6686c-.3459-.346-.5189-.5189-.7207-.6426a2.0013 2.0013 0 0 0-.5781-.2394C10.4083 2 10.1637 2 9.6745 2H5.2c-1.1201 0-1.6802 0-2.108.218a2 2 0 0 0-.874.874C2 3.5198 2 4.08 2 5.2ZM8.5 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z"})]}))};const _t={all:e(ht,{}),inbox:e(zt,{}),sent:e(St,{}),trash:e(wt,{}),drafts:e(pt,{}),spam:e(Ct,{}),starred:e(ke,{}),important:e(Wt,{}),favorites:e(vt,{})},$t=a=>a.type==="system"?_t[a.id]:e(Nt,{}),Gt=a=>a.type==="custom"&&a.color||"inherit",at=a=>{const{active:t,unread:n,label:i,...c}=a,s=$t(i),d=Gt(i);return i.unreadCount&&i.unreadCount>0,e(dt,{disableGutters:!0,disablePadding:!0,sx:{"& + &":{mt:1}},...c,children:l(mt,{sx:{borderRadius:1,color:"text.secondary",flexGrow:1,fontSize:m=>m.typography.button.fontSize,fontWeight:m=>m.typography.button.fontWeight,justifyContent:"flex-start",lineHeight:m=>m.typography.button.lineHeight,py:1,px:2,textAlign:"left","&:hover":{backgroundColor:"action.hover"},...t&&{backgroundColor:"action.selected",color:"text.primary"}},children:[e(E,{sx:{color:d,mr:1},children:s}),e(x,{sx:{flexGrow:1},children:i.name}),n!=0&&i.id=="inbox"&&e(y,{color:"inherit",variant:"subtitle2",children:n})]})})};at.propTypes={active:u.bool,label:u.object.isRequired,onClick:u.func};const Ut=a=>{const t={system:[],template:[],custom:[]};return a.forEach(n=>{n.type==="system"?t.system.push(n):n.type==="template"?t.template.push(n):t.custom.push(n)}),t},Ce=a=>{const{currentLabelId:t="inbox",container:n,labels:i,unread:c,onClose:s,onCompose:d,open:m,...g}=a,b=de(),w=ge(k=>k.breakpoints.up("md")),f=o.useCallback(k=>{w||s==null||s();const M=k.id!=="inbox"?U.dashboard.mail+`?label=${k.id}`:U.dashboard.mail;b.push(M)},[b,w,s]),p=Ut(i),C=l("div",{children:[l(S,{alignItems:"center",direction:"row",spacing:2,sx:{pt:2,px:2},children:[e(y,{variant:"h5",sx:{flexGrow:1},children:"Mailbox"}),!w&&e($,{onClick:s,children:e(E,{children:e(Ee,{})})})]}),e(x,{sx:{p:2},children:e(ce,{fullWidth:!0,onClick:d,startIcon:e(E,{children:e(Ie,{})}),sx:{mt:2},variant:"contained",children:"Compose"})}),e(x,{sx:{pb:2,px:2},children:Object.keys(p).map(k=>l(o.Fragment,{children:[k==="template"&&e(It,{disableSticky:!0,children:e(y,{color:"text.secondary",variant:"overline",children:"Templates"})}),e(ut,{disablePadding:!0,children:p[k].map(M=>{const h=t===M.id;return e(at,{active:h,unread:c,label:M,onClick:()=>f(M)},M.id)})})]},k))})]});return w?e(Te,{anchor:"left",open:m,PaperProps:{sx:{position:"relative",width:280}},SlideProps:{container:n},variant:"persistent",...g,children:C}):e(Te,{anchor:"left",hideBackdrop:!0,ModalProps:{container:n,sx:{pointerEvents:"none",position:"absolute"}},onClose:s,open:m,PaperProps:{sx:{maxWidth:"100%",width:280,pointerEvents:"auto",position:"absolute"}},SlideProps:{container:n},variant:"temporary",...g,children:C})};Ce.propTypes={container:u.any,currentLabelId:u.string,labels:u.array.isRequired,onClose:u.func,onCompose:u.func,open:u.bool};const qt=()=>{const a=P(),t=K(i=>i.mail.labels),n=o.useCallback(()=>{a(J.getLabels())},[a]);return o.useEffect(()=>{n()},[]),t},Ht=()=>{const a={isFullScreen:!1,isOpen:!1,message:"",subject:"",inlineImgs:[],to:"",toDisplay:"",loading:!1,data:new FormData},t=P(),[n,i]=o.useState(a),c=ae().get("label")||"inbox",s=o.useCallback(()=>{i(r=>({...r,isOpen:!0}))},[]),d=o.useCallback(()=>{i(a)},[]),m=o.useCallback(()=>{i(r=>({...r,isFullScreen:!0}))},[]),g=o.useCallback(()=>{i(r=>({...r,isFullScreen:!1}))},[]),b=o.useCallback(r=>{i(v=>({...v,data:r}))},[]),w=o.useCallback(r=>{i(v=>({...v,message:r}))},[]),f=o.useCallback(r=>{let v=n.inlineImgs;v.includes(r)||(v.push(r),i(O=>({...O,inlineImgs:v})))},[]),p=o.useCallback(()=>{i(r=>({...r,inlineImgs:[]}))},[]),C=o.useCallback(r=>{i(v=>({...v,subject:r}))},[]),k=o.useCallback(r=>{i(v=>({...v,to:r}))},[]),M=o.useCallback(r=>{i(v=>({...v,toDisplay:r}))},[]);return{...n,handleClose:d,handleMaximize:m,handleMessageChange:w,handleMinimize:g,handleInlineImgsChange:f,handleInlineImgsInit:p,handleSubmit:(r="")=>{i(v=>({...v,loading:!0})),n.to!=""?n.data.append("to",n.to):n.data.append("to",r),n.data.append("subject",n.subject),n.data.append("message",n.message),n.data.append("email",JSON.parse(localStorage.getItem("email"))),n.data.append("inlineImgs",n.inlineImgs),axios.post("/api/send_mail",n.data,{}).then(v=>{ie.success("Message Sent Successfuly."),t(J.getEmails({label:c,email:JSON.parse(localStorage.getItem("email"))})),t(we({email:JSON.parse(localStorage.getItem("email"))})),i(O=>({...O,loading:!1,subject:"",to:"",toDisplay:"",inlineImgs:[],message:"",isOpen:!1,data:new FormData}))}).catch(v=>{})},handleOpen:s,handleAttach:b,handleSubjectChange:C,handleToChange:k,handleDisplayChange:M}},Jt=()=>{const a={isFullScreen:!1,isOpen:!1,message:"",subject:"",inlineImgs:[],to:"",toDisplay:"",loading:!1,data:new FormData},t=P(),[n,i]=o.useState(a);ae().get("label");const c=o.useCallback(()=>{i(h=>({...h,isOpen:!0}))},[]),s=o.useCallback(()=>{i(a)},[]),d=o.useCallback(()=>{i(h=>({...h,isFullScreen:!0}))},[]),m=o.useCallback(()=>{i(h=>({...h,isFullScreen:!1}))},[]),g=o.useCallback(h=>{i(r=>({...r,data:h}))},[]),b=o.useCallback(h=>{i(r=>({...r,message:h}))},[]),w=o.useCallback(h=>{let r=n.inlineImgs;r.includes(h)||(r.push(h),i(v=>({...v,inlineImgs:r})))},[]),f=o.useCallback(()=>{i(h=>({...h,inlineImgs:[]}))},[]),p=o.useCallback(h=>{i(r=>({...r,subject:h}))},[]),C=o.useCallback(h=>{i(r=>({...r,to:h}))},[]),k=o.useCallback(h=>{i(r=>({...r,toDisplay:h}))},[]);return{...n,handleClose:s,handleMaximize:d,handleMessageChange:b,handleMinimize:m,handleInlineImgsChange:w,handleInlineImgsInit:f,handleSubmit:()=>{i(h=>({...h,loading:!0})),n.data.append("to",n.to),n.data.append("subject",n.subject),n.data.append("message",n.message),n.data.append("email",JSON.parse(localStorage.getItem("email"))),n.data.append("inlineImgs",n.inlineImgs),axios.post("/api/save_template",n.data,{}).then(h=>{ie.success("Template saved successfuly."),t(J.getTmpEmails({label:"template",email:JSON.parse(localStorage.getItem("email"))})),t(we({email:JSON.parse(localStorage.getItem("email"))})),i(r=>({...r,loading:!1,subject:"",to:"",inlineImgs:[],message:"",isOpen:!1,data:new FormData}))}).catch(h=>{})},handleOpen:c,handleAttach:g,handleSubjectChange:p,handleToChange:C,handleDisplayChange:k}},Kt=()=>{const a=ge(d=>d.breakpoints.up("md")),[t,n]=o.useState(a),i=o.useCallback(()=>{n(!!a)},[a]);o.useEffect(()=>{i()},[a]);const c=o.useCallback(()=>{n(d=>!d)},[]),s=o.useCallback(()=>{n(!1)},[]);return{handleToggle:c,handleClose:s,open:t}},Zt=a=>{const{emails:t,cntemails:n,userinfo:i}=a;o.useState(!1),o.useEffect(()=>{let v=0;n.allIds.map(O=>{n.byId[O].isUnread.seen||v++}),h(v)},[n]);let c={time:new Date().getTime(),value:"email",expire:3e6},s=JSON.stringify(c);localStorage.setItem("time_token",s);const d=o.useRef(null),m=ae(),g=m.get("emailId"),b=m.get("label")||void 0,w=qt(),f=Ht(),p=Jt(),C=Kt(),[k,M]=o.useState(0),h=v=>{M(v)};gt();const r=g?"details":"list";return l(ne,{children:[e(ft,{title:"Dashboard: Mail"}),e(le,{}),e(x,{component:"main",sx:{backgroundColor:"background.paper",flex:"1 1 auto",overflow:"hidden",position:"relative"},children:b=="template"?l(x,{ref:d,sx:{bottom:0,display:"flex",left:0,position:"absolute",right:0,top:0},children:[e(Ce,{container:d.current,currentLabelId:b,labels:w,unread:k,onClose:C.handleClose,onCompose:p.handleOpen,open:C.open}),l(je,{open:C.open,children:[r==="details"&&e(Qe,{currentLabelId:b,onSidebarToggle:C.handleToggle,emailId:g,userinfo:i}),r==="list"&&e(nt,{currentLabelId:b,onSidebarToggle:C.handleToggle,onCompose:p.handleOpen})]})]}):l(x,{ref:d,sx:{bottom:0,display:"flex",left:0,position:"absolute",right:0,top:0},children:[e(Ce,{container:d.current,currentLabelId:b,labels:w,unread:k,onClose:C.handleClose,onCompose:f.handleOpen,open:C.open}),l(je,{open:C.open,children:[r==="details"&&e(Je,{currentLabelId:b,onSidebarToggle:C.handleToggle,emailId:g}),r==="list"&&e(et,{currentLabelId:b,onSidebarToggle:C.handleToggle,onCompose:f.handleOpen,disCount:h})]})]})}),e(bt,{maximize:f.isFullScreen,message:f.message,onClose:f.handleClose,onMessageChange:f.handleMessageChange,onMinimize:f.handleMinimize,onSubjectChange:f.handleSubjectChange,onInlineImgsChange:f.handleInlineImgsChange,onSubmit:f.handleSubmit,onAttach:f.handleAttach,onToChange:f.handleToChange,onDisplayChange:f.handleDisplayChange,handleInlineImgsInit:f.handleInlineImgsInit,inlineImgs:f.inlineImgs,open:f.isOpen,subject:f.subject,loading:f.loading,to:f.to,toDisplay:f.toDisplay}),e(Mt,{maximize:p.isFullScreen,message:p.message,onClose:p.handleClose,onMessageChange:p.handleMessageChange,onMinimize:p.handleMinimize,onSubjectChange:p.handleSubjectChange,onInlineImgsChange:p.handleInlineImgsChange,onSubmit:p.handleSubmit,onAttach:p.handleAttach,onToChange:p.handleToChange,onDisplayChange:p.handleDisplayChange,handleInlineImgsInit:p.handleInlineImgsInit,inlineImgs:p.inlineImgs,open:p.isOpen,subject:p.subject,loading:p.loading,to:p.to})]})},Vt=a=>({emails:a.mail.emails,cntemails:a.mail.cntemails,userinfo:a.profile.userinfo}),Cn=ue(Vt)(Zt);export{Cn as default};
