import{P as r,w as ce,r as s,c9 as ue,ci as T,j as l,cj as de,d as t,ck as pe,at as me,l as O,k as v,aw as ge,q as fe,c2 as he,f as u,G as be,T as ye,bx as U,aK as xe,bp as ve,D as Ce,ch as f}from"./app-15d4d073.js";import"./quill-editor-1dbd0ce2.js";import{m as we,D as C,r as Se,L as Ee,F as Ie,d as ke}from"./mail-afa3750e.js";const je=we(()=>({noBorder:{border:"none"}})),W=w=>{const{maximize:B=!1,message:_="",onClose:L,onMaximize:_e,onMessageChange:S,onMinimize:Pe,onSubjectChange:h,onAttach:K,loading:E,onToChange:i,onDisplayChange:b,onInlineImgsChange:P,inlineImgs:Y,handleInlineImgsInit:De,onSubmit:$,open:q=!1,subject:D="",to:m="",toDisplay:Me="",toemail:Fe="",avatar:M="",userinfo:d}=w,[F,z]=s.useState(C.EditorState.createEmpty()),H=F.getCurrentContent();C.convertToRaw(H);const I=ue(),[A,J]=s.useState(),X=JSON.parse(localStorage.getItem("email")),[y,Q]=s.useState(0),[k,V]=s.useState([]),[G,Z]=s.useState([]);s.useEffect(()=>{axios.post("/api/getoutreachs",{email:X},{}).then(e=>{V(e.data)})},[]),s.useEffect(()=>{axios.post("/api/get_possible_infs",{}).then(e=>{Z(e.data)}).catch(e=>{})},[]),s.useEffect(()=>{var o,a;let e="",n=k[y];n&&((o=n[0])==null?void 0:o.detail)==null?i(""):n&&((a=n[0])==null?void 0:a.detail)!=null&&n.map((c,x)=>{x==n.length-1?e+=c.detail.public_email:e+=c.detail.public_email+","}),i(e)},[y]);const ee=e=>{K(e)},te=e=>{ie(e.getCurrentContent()),z(e),J(ke(C.convertToRaw(e.getCurrentContent())))},[g,R]=s.useState(!1);je();const ne=s.useCallback(e=>{h==null||h(e.target.value)},[h]),se=s.useCallback(e=>{i==null||i(e.target.value)},[i]);s.useCallback(e=>{b==null||b(e.target.value)},[b]),s.useEffect(()=>{E==!1&&R(!1)},[E]),s.useEffect(()=>{var e,n;if(g){let o="",a=k[y];a&&((e=a[0])==null?void 0:e.detail)==null?i(""):a&&((n=a[0])==null?void 0:n.detail)!=null&&a.map((c,x)=>{x==a.length-1?o+=c.detail.public_email:o+=c.detail.public_email+","}),i(o)}else i==null||i("")},[g]);const ae=()=>{if(d.is_admin!="1"){if(d.paid=="1"&&d.message_cnt>=50){f.error(`You are trying to send 51th message this month.
 Please upgrade your membership. 
 `+d.time+"days left by renewal date.");return}else if(d.paid=="0"&&d.message_cnt>=5){f.error(`Trial user cannot send over 5 messages .
 Please upgrade your membership.`);return}}if(m==""){f.error("You should input To field.");return}if(D==""){f.error("You should input Subject field.");return}if(G.includes(m)==!1){f.error("You should input known email address of influencers"),i("");return}$()};if(s.useEffect(()=>{S==null||S(A)},[A]),s.useEffect(()=>{_==""&&z(C.EditorState.createEmpty())},[_]),!q)return null;const ie=async e=>{e.getBlockMap().forEach(n=>{n.findEntityRanges(o=>{const a=o.getEntity();return a!==null&&e.getEntity(a).getType()==="IMAGE"},async(o,a)=>{const c=e.getBlockForKey(n.getKey()).getEntityAt(o),p=e.getEntity(c).getData();Y.includes(p.src)||(P(p.src),p.src.includes("blob:http")&&axios({method:"get",url:p.src,responseType:"blob"}).then(function(re){var j=new FileReader;j.readAsDataURL(re.data),j.onloadend=function(){var le=j.result;axios.post("/api/upload_inline",{uri:p.src.split("/")[3],data:le}).then(N=>{P(p.src+"."+N.data)}).catch(N=>{})}}))})})},oe=e=>{const n={file:e,localsrc:URL.createObjectURL(e)};return new Promise((o,a)=>{o({data:{link:n.localsrc}})})};return T(".rdw-remove-wrapper").on("click",function(){I.handleOpen()}),T(".suggestion input").on("focus",function(){T("#suggestion")[0].style.display="none"}),l(de,{children:[t(pe,{open:B}),l(me,{sx:{bottom:"10%",display:"flex",flexDirection:"column",height:"80%",outline:"none",position:"fixed",left:"5%",width:"90%",zIndex:1200,overflow:"hidden"},elevation:12,children:[l(O,{sx:{alignItems:"center",display:"flex",px:2,py:1},children:[t(v,{variant:"h6",children:"New Message"}),t(O,{sx:{flexGrow:1}}),t(ge,{onClick:L,children:t(fe,{children:t(he,{})})})]}),l(u,{alignItems:"flex-start",direction:{xs:"column",sm:"row"},justifyContent:"space-between",children:[l(u,{justifyContent:"flex-start",sx:{minWidth:"200px"},children:[l(u,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(v,{sx:{mx:2},children:"To"}),t(be,{src:M!=""?M:`https://ui-avatars.com/api/?name=${m||""}&background=2970FF&color=fff&rounded=true`}),g==!0?t(ye,{sx:{height:53.13},label:"Outreach Group",name:"saved_searchs",value:y,fullWidth:!0,style:{minWidth:200},select:!0,onChange:e=>Q(e.target.value),SelectProps:{native:!0},children:k.map((e,n)=>t("option",{value:n,children:n==0?"Favorites":e[0].group_name},e.id))}):t(U,{disableUnderline:!0,fullWidth:!0,onChange:se,placeholder:"Input Address To",value:m,list:"suggestion",className:"suggestion",inputProps:{list:"suggestion"}}),t("datalist",{id:"suggestion",children:G.map((e,n)=>t("option",{value:e,children:e},n))})]}),l(u,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(v,{sx:{mx:2},children:"Subject"}),t(U,{disableUnderline:!0,fullWidth:!0,onChange:ne,placeholder:"Input Subject",value:D})]})]}),l(u,{alignItems:"center",direction:"row",spacing:1,className:"shower-reach",children:[t(v,{sx:{mx:2,fontWeight:600,fontSize:16},children:"Outreach Group"}),t(xe,{style:{marginRight:20},control:t(ve,{checked:g,onChange:()=>R(!g),name:"loading",color:"primary"})})]})]}),t(Se.Editor,{editorState:F,wrapperClassName:"wrapper-class",editorClassName:"editor-class",toolbarClassName:"toolbar-class",onEditorStateChange:te,toolbar:{options:["image","link","emoji","remove"],link:{options:["link"],link:{icon:"/assets/icons/link.png"}},emoji:{icon:"/assets/icons/smile.png"},image:{icon:"/assets/icons/image.png",uploadCallback:oe,previewImage:!0},remove:{icon:"/assets/icons/attach.png",title:"Attach"}}}),t(Ce,{}),l(u,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,sx:{p:2,mb:2},children:[t(u,{alignItems:"center",direction:"row",spacing:1,sx:{ml:27}}),t("div",{children:t(Ee,{loading:E,loadingPosition:"center",variant:"contained",onClick:ae,children:"Send Email"})})]}),t(Ie,{onClose:I.handleClose,open:I.open,onUpgrade:ee})]})]})};W.propTypes={maximize:r.bool,message:r.string,onClose:r.func,onMaximize:r.func,onMessageChange:r.func,onMinimize:r.func,onSubjectChange:r.func,onToChange:r.func,open:r.bool,subject:r.string,to:r.string};const Te=w=>({userinfo:w.profile.userinfo}),Re=ce(Te)(W);export{Re as M};
