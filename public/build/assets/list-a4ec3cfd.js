import{P as c,bF as j,bb as A,b2 as D,j as l,f as b,d as e,k as g,aZ as U,T as v,B as R,r as d,au as I,q as T,b_ as H,l as S,cC as W,an as z,bl as N,bm as _,bn as $,R as V,aO as Q,c3 as X,aT as Z,c as J,F as K,S as Y,aM as ee,D as te,u as re}from"./app-0f918c09.js";import{o as ne}from"./index-2014562a.js";import{P as ae,a as w}from"./property-list-item-3daa7664.js";import{S as se}from"./severity-pill-9451da86.js";import{T as M,b as O,c as y,a as E}from"./TableRow-9bf769c9.js";import{T as oe}from"./TableHead-5ad34eff.js";import{u as le}from"./use-update-effect-ef7df438.js";import{T as ie}from"./TablePagination-55a27de3.js";import"./deep-copy-ee95be26.js";import"./apply-pagination-03aa54c3.js";import"./apply-sort-ec30f364.js";import"./LastPage-24c4e885.js";const ce={canceled:"warning",complete:"success",pending:"info",rejected:"error"},B=r=>{const{onApprove:t,onEdit:o,onReject:n,order:a}=r,s=j(p=>p.breakpoints.up("lg"))?"horizontal":"vertical",i=a.items||[],h=A(Date.parse(a.createdAt),"dd/MM/yyyy HH:mm"),f=ce[a.status],C=D(a.totalAmount).format(`${a.currency}0,0.00`);return l(b,{spacing:6,children:[l(b,{spacing:3,children:[e(b,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,children:e(g,{variant:"h6",children:"Details"})}),l(ae,{children:[e(w,{align:s,disableGutters:!0,divider:!0,label:"ID",value:a.id}),e(w,{align:s,disableGutters:!0,divider:!0,label:"Number",value:a.number}),l(w,{align:s,disableGutters:!0,divider:!0,label:"Customer",children:[e(g,{color:"text.secondary",variant:"body2",children:a.customer.name}),e(g,{color:"text.secondary",variant:"body2",children:a.customer.address1})]}),e(w,{align:s,disableGutters:!0,divider:!0,label:"Date",value:h}),e(w,{align:s,disableGutters:!0,divider:!0,label:"Promotion Code",value:a.promotionCode}),e(w,{align:s,disableGutters:!0,divider:!0,label:"Total Amount",value:C}),e(w,{align:s,disableGutters:!0,divider:!0,label:"Status",children:e(se,{color:f,children:a.status})})]})]}),l(b,{spacing:3,children:[e(g,{variant:"h6",children:"Line items"}),e(U,{children:l(M,{sx:{minWidth:400},children:[e(oe,{children:l(O,{children:[e(y,{children:"Description"}),e(y,{children:"Billing Cycle"}),e(y,{children:"Amount"})]})}),e(E,{children:i.map(p=>{const m=D(p.unitAmount).format(`${p.currency}0,0.00`);return l(O,{children:[l(y,{children:[p.name," x ",p.quantity]}),e(y,{children:p.billingCycle}),e(y,{children:m})]},p.id)})})]})})]})]})};B.propTypes={onApprove:c.func,onEdit:c.func,onReject:c.func,order:c.object};const de=[{label:"Canceled",value:"canceled"},{label:"Complete",value:"complete"},{label:"Pending",value:"pending"},{label:"Rejected",value:"rejected"}],G=r=>{const{onCancel:t,onSave:o,order:n}=r,a=A(n.createdAt,"dd/MM/yyyy HH:mm");return e(b,{spacing:6,children:l(b,{spacing:3,children:[e(g,{variant:"h6",children:"Details"}),l(b,{spacing:3,children:[e(v,{disabled:!0,fullWidth:!0,label:"ID",name:"id",value:n.id}),e(v,{disabled:!0,fullWidth:!0,label:"Number",name:"number",value:n.number}),e(v,{disabled:!0,fullWidth:!0,label:"Customer name",name:"customer_name",value:n.customer.name}),e(v,{disabled:!0,fullWidth:!0,label:"Date",name:"date",value:a}),e(v,{fullWidth:!0,label:"Address",name:"address",value:n.customer.address1}),e(v,{fullWidth:!0,label:"Country",name:"country",value:n.customer.country}),e(v,{fullWidth:!0,label:"State/Region",name:"state_region",value:n.customer.city}),e(v,{fullWidth:!0,label:"Total Amount",name:"amount",value:n.totalAmount}),e(v,{fullWidth:!0,label:"Status",name:"status",select:!0,SelectProps:{native:!0},value:n.status,children:de.map(u=>e("option",{value:u.value,children:u.label},u.value))})]}),l(b,{alignItems:"center",direction:"row",flexWrap:"wrap",spacing:2,children:[e(R,{color:"primary",onClick:o,size:"small",variant:"contained",children:"Save changes"}),e(R,{color:"inherit",onClick:t,size:"small",children:"Cancel"})]})]})})};G.propTypes={onCancel:c.func,onSave:c.func,order:c.object};const F=r=>{const{container:t,onClose:o,open:n,order:a}=r,[u,s]=d.useState(!1),i=j(p=>p.breakpoints.up("lg")),h=d.useCallback(()=>{s(!0)},[]),f=d.useCallback(()=>{s(!1)},[]);let C=null;return a&&(C=l("div",{children:[l(b,{alignItems:"center",direction:"row",justifyContent:"space-between",sx:{px:3,py:2},children:[e(g,{color:"inherit",variant:"h6",children:a.number}),e(I,{color:"inherit",onClick:o,children:e(T,{children:e(H,{})})})]}),e(S,{sx:{px:3,py:4},children:u?e(G,{onCancel:f,onSave:f,order:a}):e(B,{onApprove:o,onEdit:h,onReject:o,order:a})})]})),i?e(W,{anchor:"right",open:n,PaperProps:{sx:{maxWidth:"100%",width:350}},SlideProps:{container:t},variant:"persistent",children:C}):e(W,{anchor:"right",ModalProps:{container:t},onClose:o,open:n,PaperProps:{sx:{maxWidth:"100%",width:350}},SlideProps:{container:t},variant:"temporary",children:C})};F.propTypes={container:c.any,onClose:c.func,open:c.bool,order:c.object};z("div",{shouldForwardProp:r=>r!=="open"})(({theme:r,open:t})=>({flexGrow:1,overflow:"auto",zIndex:1,[r.breakpoints.up("lg")]:{marginRight:-500},transition:r.transitions.create("margin",{easing:r.transitions.easing.sharp,duration:r.transitions.duration.leavingScreen}),...t&&{[r.breakpoints.up("lg")]:{marginRight:0},transition:r.transitions.create("margin",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.enteringScreen})}}));const ue=[{label:"Newest",value:"desc"},{label:"Oldest",value:"asc"}],L=r=>{const{onFiltersChange:t,onSortChange:o,sortDir:n="asc"}=r,a=d.useRef(null),[u,s]=d.useState("all"),[i,h]=d.useState({query:void 0,status:void 0}),f=d.useCallback(()=>{t==null||t(i)},[i,t]);le(()=>{f()},[i,f]),d.useCallback((m,P)=>{s(P);const x=P==="all"?void 0:P;h(k=>({...k,status:x}))},[]);const C=d.useCallback(m=>{var x;m.preventDefault();const P=((x=a.current)==null?void 0:x.value)||"";h(k=>({...k,query:P}))},[]),p=d.useCallback(m=>{const P=m.target.value;o==null||o(P)},[o]);return e("div",{children:l(b,{alignItems:"center",direction:"row",flexWrap:"wrap",gap:3,sx:{p:3},children:[e(S,{component:"form",onSubmit:C,sx:{flexGrow:1},children:e(N,{defaultValue:"",fullWidth:!0,inputProps:{ref:a},name:"orderNumber",placeholder:"Search by order number",startAdornment:e(_,{position:"start",children:e(T,{children:e($,{})})})})}),e(v,{label:"Sort By",name:"sort",onChange:p,select:!0,SelectProps:{native:!0},value:n,children:ue.map(m=>e("option",{value:m.value,children:m.label},m.value))})]})})};L.propTypes={onFiltersChange:c.func,onSortChange:c.func,sortBy:c.string,sortDir:c.oneOf(["asc","desc"])};const he={complete:"success",pending:"info",canceled:"warning",rejected:"error"},q=r=>{const{count:t=0,items:o=[],onPageChange:n=()=>{},onRowsPerPageChange:a,onSelect:u,page:s=0,rowsPerPage:i=0}=r;return l("div",{children:[e(M,{children:e(E,{children:o.map(h=>{const f=A(Date.parse(h.createdAt),"LLL").toUpperCase(),C=A(Date.parse(h.createdAt),"d"),p=D(h.totalAmount).format(`${h.currency}0,0.00`);return he[h.status],l(O,{hover:!0,onClick:()=>u==null?void 0:u(h.id),sx:{cursor:"pointer"},children:[l(y,{sx:{alignItems:"center",display:"flex"},children:[l(S,{sx:{backgroundColor:m=>m.palette.mode==="dark"?"neutral.800":"neutral.200",borderRadius:2,maxWidth:"fit-content",ml:3,p:1},children:[e(g,{align:"center",variant:"subtitle2",children:f}),e(g,{align:"center",variant:"h6",children:C})]}),l(S,{sx:{ml:2},children:[e(g,{variant:"subtitle2",children:h.number}),l(g,{color:"text.secondary",variant:"body2",children:["Total of ",p]})]})]}),e(y,{align:"right",children:l(I,{component:V,href:"/dashboard/invoices/"+h.id,children:[e(g,{variant:"subtitle2",children:"View Invoice"}),e(T,{children:e(Q,{})})]})})]},h.id)})})}),e(ie,{component:"div",count:t,onPageChange:n,onRowsPerPageChange:a,page:s,rowsPerPage:i,rowsPerPageOptions:[5,10,25]})]})};q.propTypes={count:c.number,items:c.array,onPageChange:c.func,onRowsPerPageChange:c.func,onSelect:c.func,page:c.number,rowsPerPage:c.number};const pe=()=>{const[r,t]=d.useState({filters:{query:void 0,status:void 0},page:0,rowsPerPage:5,sortBy:"createdAt",sortDir:"desc",orders:[]});d.useEffect(()=>{axios.post("/api/get_orders",{}).then(s=>{t(i=>({...i,orders:s.data}))})},[]);const o=d.useCallback(s=>{t(i=>({...i,filters:s}))},[]),n=d.useCallback(s=>{t(i=>({...i,sortDir:s}))},[]),a=d.useCallback((s,i)=>{t(h=>({...h,page:i}))},[]),u=d.useCallback(s=>{t(i=>({...i,rowsPerPage:parseInt(s.target.value,10)}))},[]);return{handleFiltersChange:o,handleSortChange:n,handlePageChange:a,handleRowsPerPageChange:u,state:r}},me=r=>{const t=re(),[o,n]=d.useState({orders:[],ordersCount:0}),a=d.useCallback(async()=>{try{const u=await ne.getOrders(r);t()&&n({orders:u.data,ordersCount:u.count})}catch(u){console.error(u)}},[r,t]);return d.useEffect(()=>{a()},[r]),{...o}},ge=(r,t)=>d.useMemo(()=>{if(t)return r.find(o=>o.id===t)},[r,t]),Oe=()=>{const r=d.useRef(null),t=pe(),o=me(t.state),n=X(),a=ge(o.orders,n.data),u=Z();J();const s=d.useCallback(i=>{if(n.open&&n.data===i){n.handleClose();return}n.handleOpen(i)},[n]);return l(K,{children:[e(Y,{title:"Dashboard: Order List"}),e(S,{component:"main",ref:r,sx:{flexGrow:1,py:8},children:e(ee,{maxWidth:u.stretch?!1:"xl",children:e("div",{children:l(S,{ref:r,children:[e(S,{sx:{p:3},children:e(b,{alignItems:"flex-start",direction:"row",justifyContent:"space-between",spacing:4,children:e("div",{children:e(g,{variant:"h4",children:"Orders"})})})}),e(L,{onFiltersChange:t.handleFiltersChange,onSortChange:t.handleSortChange,sortBy:t.state.sortBy,sortDir:t.state.sortDir}),e(te,{}),e(q,{count:o.ordersCount,items:o.orders,onPageChange:t.handlePageChange,onRowsPerPageChange:t.handleRowsPerPageChange,onSelect:s,page:t.state.page,rowsPerPage:t.state.rowsPerPage}),e(F,{container:r.current,onClose:n.handleClose,open:n.open,order:a})]})})})})]})};export{Oe as default};
