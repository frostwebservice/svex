import{r as l,_ as H,K as D,d as e,aq as ne,bE as E,cz as O,cA as V,ap as re,P as v,j as s,f as b,k as p,aw as J,q as R,c2 as oe,bm as ae,bn as se,bo as ie,h as W,T as q,l as A,aY as X,bP as ce,aK as F,m as le,bp as B,cB as _,w as de,aM as w,C as S,e as j,G as L,b1 as ue,b9 as K,R as $,aN as pe,aS as he,c as ge,F as fe,S as me,D as be,aL as ve,B as Pe,u as ye}from"./app-0b2379dc.js";import{d as Q}from"./deep-copy-ee95be26.js";import{a as Ce}from"./apply-pagination-03aa54c3.js";import{u as ke,d as we,D as De,M as xe}from"./MobileDatePicker-1ee56601.js";import{k as Ie,h as Se,i as Te,K as Me,C as Le}from"./PureDateInput-30de85c4.js";import{C as Re}from"./Clock-df8aa38c.js";import{R as Fe}from"./Receipt-2e3f870c.js";import{S as je}from"./severity-pill-743f9b24.js";import{g as Ae}from"./get-initials-d1c6cec7.js";import{T as z,a as N,b as Ee,c as I}from"./TableRow-64f18a5f.js";import{T as Ge}from"./TablePagination-d8efb43a.js";import"./Grid-ebf29dce.js";import"./createTheme-da5de8d9.js";import"./DialogActions-cb0d3279.js";import"./LastPage-de27fa04.js";const Oe=["onChange","PopperProps","PaperProps","ToolbarComponent","TransitionComponent","value","components","componentsProps"],Ve=l.forwardRef(function(n,t){const c=ke(n,"MuiDesktopDatePicker"),d=Ie(c)!==null,{pickerProps:r,inputProps:i,wrapperProps:f}=Se(c,we),{PopperProps:u,PaperProps:h,ToolbarComponent:k=De,TransitionComponent:P,components:y,componentsProps:C}=c,m=H(c,Oe),x=D({},i,m,{components:y,componentsProps:C,ref:t,validationError:d});return e(Te,D({},f,{DateInputProps:x,KeyboardDateInputComponent:Me,PopperProps:u,PaperProps:h,TransitionComponent:P,components:y,componentsProps:C,children:e(Le,D({},r,{autoFocus:!0,toolbarTitle:c.label||c.toolbarTitle,ToolbarComponent:k,DateInputProps:x,components:y,componentsProps:C},m))}))}),We=["desktopModeMediaQuery","DialogProps","PopperProps","TransitionComponent"],U=l.forwardRef(function(n,t){const c=ne({props:n,name:"MuiDatePicker"}),{desktopModeMediaQuery:d="@media (pointer: fine)",DialogProps:r,PopperProps:i,TransitionComponent:f}=c,u=H(c,We);return E(d,{defaultMatches:!0})?e(Ve,D({ref:t,PopperProps:i,TransitionComponent:f},u)):e(xe,D({ref:t,DialogProps:r},u))});var qe=function(n){return e("svg",D({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},n,{children:e("path",{fill:"#fff",fillOpacity:.01,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4.44c0-.504 0-.756.098-.9486a.9.9 0 0 1 .3934-.3933C3.684 3 3.936 3 4.44 3h15.12c.504 0 .7561 0 .9486.098a.9003.9003 0 0 1 .3933.3934C21 3.684 21 3.936 21 4.44v.6024c0 .242 0 .363-.0296.4754a.9013.9013 0 0 1-.1274.2792c-.0657.096-.1571.1752-.3399.3337l-5.7562 4.9887c-.1828.1584-.2742.2376-.3399.3336a.9015.9015 0 0 0-.1274.2792c-.0296.1125-.0296.2334-.0296.4753v4.705c0 .176 0 .264-.0284.3401a.4503.4503 0 0 1-.119.1758c-.0601.0546-.1418.0873-.3052.1526l-3.06 1.224c-.3308.1324-.4962.1985-.629.1709a.45.45 0 0 1-.2835-.1919c-.0749-.1131-.0749-.2912-.0749-.6475v-5.929c0-.2419 0-.3628-.0296-.4753a.9003.9003 0 0 0-.1274-.2792c-.0657-.096-.157-.1752-.3399-.3336L3.4969 6.1306c-.1828-.1584-.2742-.2376-.3399-.3336a.9001.9001 0 0 1-.1274-.2792C3 5.4053 3 5.2844 3 5.0424V4.44Z"})}))};class Be{getInvoices(n={}){const{filters:t,page:c,rowsPerPage:d,invoices:r}=n;let i=Q(r),f=i.length;return typeof t<"u"&&(i=i.filter(u=>!(typeof t.query<"u"&&t.query!==""&&!u.number.toLowerCase().includes(t.query.toLowerCase())||typeof t.startDate<"u"&&(typeof u.issueDate>"u"||!(O(u.issueDate)>=V(t.startDate)))||typeof t.endDate<"u"&&(typeof u.issueDate>"u"||!(V(u.issueDate)<=O(t.endDate)))||typeof t.customers<"u"&&t.customers.length>0&&!t.customers.includes(u.customer.name)||typeof t.status<"u"&&u.status!==t.status)),f=i.length),typeof c<"u"&&typeof d<"u"&&(i=Ce(i,c,d)),Promise.resolve({data:i,count:f})}getInvoice(n={}){const{invoice:t}=n;return Q(t)}}const _e=new Be,Ke=re("div",{shouldForwardProp:o=>o!=="open"})(({theme:o,open:n})=>({flexGrow:1,overflow:"auto",paddingLeft:o.spacing(3),paddingRight:o.spacing(3),paddingTop:o.spacing(8),paddingBottom:o.spacing(8),zIndex:1,[o.breakpoints.up("lg")]:{marginLeft:-380},transition:o.transitions.create("margin",{easing:o.transitions.easing.sharp,duration:o.transitions.duration.leavingScreen}),...n&&{[o.breakpoints.up("lg")]:{marginLeft:0},transition:o.transitions.create("margin",{easing:o.transitions.easing.easeOut,duration:o.transitions.duration.enteringScreen})}})),Y=o=>{const{container:n,filters:t={},group:c,onClose:d,onFiltersChange:r,onGroupChange:i,open:f,...u}=o,[h,k]=l.useState([]);l.useEffect(()=>{axios.post("/api/get_customers",{}).then(a=>{k(a.data)})},[]);const P=l.useRef(null),y=E(a=>a.breakpoints.up("lg")),C=l.useCallback(a=>{var g;a.preventDefault(),r==null||r({...t,query:((g=P.current)==null?void 0:g.value)||""})},[t,r]),m=l.useCallback(a=>{const g={...t,startDate:a||void 0};g.endDate&&a&&a>g.endDate&&(g.endDate=a),r==null||r(g)},[t,r]),x=l.useCallback(a=>{const g={...t,endDate:a||void 0};g.startDate&&a&&a<g.startDate&&(g.startDate=a),r==null||r(g)},[t,r]),T=l.useCallback(a=>{let g;a.target.checked?g=[...t.customers||[],a.target.value]:g=(t.customers||[]).filter(M=>M!==a.target.value),r==null||r({...t,customers:g})},[t,r]),te=l.useCallback(a=>{r==null||r({...t,status:a.target.checked?"paid":void 0})},[t,r]),G=s("div",{children:[s(b,{alignItems:"center",justifyContent:"space-between",direction:"row",sx:{p:3},children:[e(p,{variant:"h5",children:"Filters"}),e(J,{onClick:d,children:e(R,{children:e(oe,{})})})]}),s(b,{spacing:3,sx:{p:3},children:[e("form",{onSubmit:C,children:e(ae,{defaultValue:"",fullWidth:!0,inputProps:{ref:P},placeholder:"Invoice number",startAdornment:e(se,{position:"start",children:e(R,{children:e(ie,{})})})})}),s("div",{children:[e(W,{sx:{display:"block",mb:2},children:"Issue date"}),s(b,{spacing:2,children:[e(U,{inputFormat:"dd/MM/yyyy",label:"From",onChange:m,renderInput:a=>e(q,{...a}),value:t.startDate||null}),e(U,{inputFormat:"dd/MM/yyyy",label:"To",onChange:x,renderInput:a=>e(q,{...a}),value:t.endDate||null})]})]}),s("div",{children:[e(W,{sx:{display:"block",mb:2},children:"From customer"}),e(A,{sx:{backgroundColor:a=>a.palette.mode==="dark"?"neutral.800":"neutral.50",borderColor:"divider",borderRadius:1,borderStyle:"solid",borderWidth:1},children:e(X,{sx:{maxHeight:200},children:e(ce,{sx:{py:1,px:1.5},children:h.map(a=>{var M;const g=(M=t.customers)==null?void 0:M.includes(a);return e(F,{control:e(le,{checked:g,onChange:T}),label:a,value:a},a)})})})})]}),e(F,{control:e(B,{checked:t.status==="paid",onChange:te}),label:"Paid only"}),e(F,{control:e(B,{checked:c,onChange:i}),label:"Group by status"})]})]});return y?e(_,{anchor:"left",open:f,PaperProps:{elevation:16,sx:{border:"none",borderRadius:2.5,overflow:"hidden",position:"relative",width:380}},SlideProps:{container:n},variant:"persistent",sx:{p:3},...u,children:G}):e(_,{anchor:"left",hideBackdrop:!0,ModalProps:{container:n,sx:{pointerEvents:"none",position:"absolute"}},onClose:d,open:f,PaperProps:{sx:{maxWidth:"100%",width:380,pointerEvents:"auto",position:"absolute"}},SlideProps:{container:n},variant:"temporary",...u,children:G})};Y.propTypes={container:v.any,filters:v.object,onClose:v.func,onFiltersChange:v.func,open:v.bool};var $e=function(n){return s("svg",D({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},n,{children:[e("path",{fill:"#fff",fillOpacity:.01,d:"M4 7.8c0-1.6802 0-2.5202.327-3.162a3 3 0 0 1 1.311-1.311C6.2798 3 7.1198 3 8.8 3h6.4c1.6802 0 2.5202 0 3.162.327a2.9997 2.9997 0 0 1 1.311 1.311C20 5.2798 20 6.1198 20 7.8V21l-2.75-2-2.5 2L12 19l-2.75 2-2.5-2L4 21V7.8Z"}),e("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m9 10.5 2 2L15.5 8M20 21V7.8c0-1.6802 0-2.5202-.327-3.162a2.9997 2.9997 0 0 0-1.311-1.311C17.7202 3 16.8802 3 15.2 3H8.8c-1.6802 0-2.5202 0-3.162.327a3 3 0 0 0-1.311 1.311C4 5.2798 4 6.1198 4 7.8V21l2.75-2 2.5 2L12 19l2.75 2 2.5-2L20 21Z"})]}))};const Qe=o=>{const{count:n,items:t,userinfo:c}=o;l.useState(0);const[d,r]=l.useState(0);return l.useState(!1),l.useEffect(()=>{},[c]),l.useEffect(()=>{const i=t.reduce((f,u)=>f+Number(u.totalAmount),0);r(i.toFixed(2))},[t]),e("div",{children:s(w,{container:!0,spacing:3,children:[e(w,{xs:12,md:6,lg:4,children:e(S,{children:e(j,{children:s(b,{alignItems:"center",direction:"row",spacing:2,children:[e(L,{sx:{height:48,width:48},children:e(Fe,{})}),s("div",{children:[e(p,{color:"text.secondary",variant:"body2",children:"Total"}),s(p,{variant:"h6",children:["$",d]}),s(p,{color:"text.secondary",variant:"body2",children:["from ",n," invoices"]})]})]})})})}),e(w,{xs:12,md:6,lg:4,children:e(S,{children:e(j,{children:s(b,{alignItems:"center",direction:"row",spacing:2,children:[e(L,{sx:{backgroundColor:"success.lightest",color:"success.main",height:48,width:48},children:e($e,{})}),s("div",{children:[e(p,{color:"text.secondary",variant:"body2",children:"Paid"}),s(p,{variant:"h6",children:["$",d]}),s(p,{color:"text.secondary",variant:"body2",children:["from ",n," invoices"]})]})]})})})}),e(w,{xs:12,md:6,lg:4,children:e(S,{children:e(j,{children:s(b,{alignItems:"center",direction:"row",spacing:2,children:[e(L,{sx:{backgroundColor:"warning.lightest",color:"warning.main",height:48,width:48},children:e(Re,{})}),s("div",{children:[e(p,{color:"text.secondary",variant:"body2",children:"Pending"}),e(p,{variant:"h6",children:"$0.00"}),e(p,{color:"text.secondary",variant:"body2",children:"from 0 invoices"})]})]})})})})]})})},ze=o=>({userinfo:o.profile.userinfo}),Ne=de(ze)(Qe),Ue=o=>o.reduce((n,t)=>{const{status:c}=t;return{...n,[c]:[...n[c],t]}},{canceled:[],paid:[],pending:[]}),Ze={canceled:"error",paid:"success",pending:"warning"},Z=o=>{const{invoice:n,...t}=o,c=Ze[n.status],d=ue(n.totalAmount).format("0,0.00"),r=n.issueDate&&K(Date.parse(n.issueDate),"dd/MM/yyyy"),i=n.dueDate&&K(Date.parse(n.dueDate),"dd/MM/yyyy");return s(Ee,{sx:{"&:last-child td, &:last-child th":{border:0}},...t,children:[e(I,{width:"25%",children:s(b,{alignItems:"center",direction:"row",spacing:2,component:$,href:"/dashboard/invoices/"+n.id,sx:{display:"inline-flex",textDecoration:"none",whiteSpace:"nowrap"},children:[e(L,{sx:{height:42,width:42},children:Ae(n.customer.name)}),s("div",{children:[e(p,{color:"text.primary",variant:"subtitle2",children:n.number}),e(p,{color:"text.secondary",variant:"body2",children:n.customer.name})]})]})}),e(I,{children:s(p,{variant:"subtitle2",children:[n.currency,d]})}),s(I,{children:[e(p,{variant:"subtitle2",children:"Issued"}),e(p,{color:"text.secondary",variant:"body2",children:r})]}),s(I,{children:[e(p,{variant:"subtitle2",children:"Due"}),e(p,{color:"text.secondary",variant:"body2",children:i})]}),e(I,{align:"right",children:e(je,{color:c,children:n.status})}),e(I,{align:"right",children:e(J,{component:$,href:"/dashboard/invoices/"+n.id,children:e(R,{children:e(pe,{})})})})]})},ee=o=>{const{group:n=!1,items:t=[],count:c=0,onPageChange:d=()=>{},onRowsPerPageChange:r,page:i=0,rowsPerPage:f=0}=o;let u;if(n){const h=Ue(t),k=Object.keys(h);u=e(b,{spacing:6,children:k.map(P=>{const y=P.charAt(0).toUpperCase()+P.slice(1),C=h[P].length,m=h[P],x=m.length>0;return s(b,{spacing:2,children:[s(p,{color:"text.secondary",variant:"h6",children:[y," (",C,")"]}),x&&e(S,{children:e(X,{children:e(z,{sx:{minWidth:600},children:e(N,{children:m.map(T=>e(Z,{invoice:T},T.id))})})})})]},y)})})}else u=e(S,{children:e(z,{children:e(N,{children:t.map(h=>e(Z,{invoice:h},h.id))})})});return s(b,{spacing:4,children:[u,e(Ge,{component:"div",count:c,onPageChange:d,onRowsPerPageChange:r,page:i,rowsPerPage:f,rowsPerPageOptions:[5,10,25]})]})};ee.propTypes={count:v.number,group:v.bool,items:v.array,onPageChange:v.func,onRowsPerPageChange:v.func,page:v.number,rowsPerPage:v.number};const He=()=>{const[o,n]=l.useState({filters:{customers:[],endDate:void 0,query:"",startDate:void 0},page:0,rowsPerPage:5,invoices:[]});l.useEffect(()=>{axios.post("/api/get_invoices",{}).then(r=>{n(i=>({...i,invoices:r.data}))})},[]);const t=l.useCallback(r=>{n(i=>({...i,filters:r,page:0}))},[]),c=l.useCallback((r,i)=>{n(f=>({...f,page:i}))},[]),d=l.useCallback(r=>{n(i=>({...i,rowsPerPage:parseInt(r.target.value,10)}))},[]);return{handleFiltersChange:t,handlePageChange:c,handleRowsPerPageChange:d,state:o}},Je=o=>{const n=ye(),[t,c]=l.useState({invoices:[],invoicesCount:0}),d=l.useCallback(async()=>{try{const r=await _e.getInvoices(o);n()&&c({invoices:r.data,invoicesCount:r.count})}catch(r){console.error(r)}},[o,n]);return l.useEffect(()=>{d()},[o]),{...t}},ht=()=>{let o={time:new Date().getTime(),value:"email",expire:3e6},n=JSON.stringify(o);localStorage.setItem("time_token",n);const t=l.useRef(null),c=E(m=>m.breakpoints.up("lg")),d=He(),r=Je(d.state),[i,f]=l.useState(!0),[u,h]=l.useState(c),k=he();ge();const P=l.useCallback(m=>{f(m.target.checked)},[]),y=l.useCallback(()=>{h(m=>!m)},[]),C=l.useCallback(()=>{h(!1)},[]);return s(fe,{children:[e(me,{title:"Dashboard: Invoice List"}),e(be,{}),e(A,{component:"main",sx:{flexGrow:1,py:8},children:e(ve,{maxWidth:k.stretch?!1:"xl",children:e(A,{ref:t,children:s(w,{container:!0,spacing:3,children:[e(w,{xs:12,lg:4,children:e(Y,{container:t.current,filters:d.state.filters,group:i,onFiltersChange:d.handleFiltersChange,onClose:C,onGroupChange:P,open:u})}),e(w,{xs:12,lg:8,children:e(Ke,{open:u,children:s(b,{spacing:4,children:[s(b,{alignItems:"flex-start",direction:"row",justifyContent:"space-between",spacing:3,children:[e("div",{children:e(p,{variant:"h4",children:"Invoices"})}),e(b,{alignItems:"center",direction:"row",spacing:1,children:e(Pe,{color:"inherit",startIcon:e(R,{children:e(qe,{})}),onClick:y,children:"Filters"})})]}),e(Ne,{items:r.invoices,count:r.invoicesCount}),e(ee,{count:r.invoicesCount,group:i,items:r.invoices,onPageChange:d.handlePageChange,onRowsPerPageChange:d.handleRowsPerPageChange,page:d.state.page,rowsPerPage:d.state.rowsPerPage})]})})})]})})})})]})};export{ht as default};
