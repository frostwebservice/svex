import{P as h,bE as W,b9 as A,b1 as k,j as o,f,d as e,k as g,aY as q,T as C,B as R,r as c,aw as E,q as O,c2 as U,l as w,cD as j,ap as H,bm as _,bn as z,bo as $,R as V,aN as Q,w as J,o as X,c8 as Y,aS as K,c as Z,F as ee,S as te,aL as re,D as ne,u as ae}from"./app-99b40063.js";import{o as se}from"./index-cdff2a2a.js";import{P as oe,a as S}from"./property-list-item-1f8b793f.js";import{S as le}from"./severity-pill-20cd942c.js";import{T as I,b as T,c as y,a as M}from"./TableRow-3f98919f.js";import{T as ie}from"./TableHead-c9a6c4e8.js";import{u as ce}from"./use-update-effect-e2dd98c0.js";import{T as de}from"./TablePagination-7695cf01.js";import"./apply-pagination-03aa54c3.js";import"./apply-sort-ec30f364.js";import"./LastPage-ea44aac4.js";const ue={canceled:"warning",complete:"success",pending:"info",rejected:"error"},B=t=>{const{onApprove:n,onEdit:d,onReject:l,order:a}=t,r=W(p=>p.breakpoints.up("lg"))?"horizontal":"vertical",i=a.items||[],s=A(Date.parse(a.createdAt),"dd/MM/yyyy HH:mm"),b=ue[a.status],v=k(a.totalAmount).format(`${a.currency}0,0.00`);return o(f,{spacing:6,children:[o(f,{spacing:3,children:[e(f,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,children:e(g,{variant:"h6",children:"Details"})}),o(oe,{children:[e(S,{align:r,disableGutters:!0,divider:!0,label:"ID",value:a.id}),e(S,{align:r,disableGutters:!0,divider:!0,label:"Number",value:a.number}),o(S,{align:r,disableGutters:!0,divider:!0,label:"Customer",children:[e(g,{color:"text.secondary",variant:"body2",children:a.customer.name}),e(g,{color:"text.secondary",variant:"body2",children:a.customer.address1})]}),e(S,{align:r,disableGutters:!0,divider:!0,label:"Date",value:s}),e(S,{align:r,disableGutters:!0,divider:!0,label:"Promotion Code",value:a.promotionCode}),e(S,{align:r,disableGutters:!0,divider:!0,label:"Total Amount",value:v}),e(S,{align:r,disableGutters:!0,divider:!0,label:"Status",children:e(le,{color:b,children:a.status})})]})]}),o(f,{spacing:3,children:[e(g,{variant:"h6",children:"Line items"}),e(q,{children:o(I,{sx:{minWidth:400},children:[e(ie,{children:o(T,{children:[e(y,{children:"Description"}),e(y,{children:"Billing Cycle"}),e(y,{children:"Amount"})]})}),e(M,{children:i.map(p=>{const m=k(p.unitAmount).format(`${p.currency}0,0.00`);return o(T,{children:[o(y,{children:[p.unitAmount=="49"?"Essential Membership":"Premium Membership"," ","x ",p.quantity]}),e(y,{children:p.billingCycle}),e(y,{children:m})]},p.id)})})]})})]})]})};B.propTypes={onApprove:h.func,onEdit:h.func,onReject:h.func,order:h.object};const he=[{label:"Canceled",value:"canceled"},{label:"Complete",value:"complete"},{label:"Pending",value:"pending"},{label:"Rejected",value:"rejected"}],G=t=>{const{onCancel:n,onSave:d,order:l}=t,a=A(l.createdAt,"dd/MM/yyyy HH:mm");return e(f,{spacing:6,children:o(f,{spacing:3,children:[e(g,{variant:"h6",children:"Details"}),o(f,{spacing:3,children:[e(C,{disabled:!0,fullWidth:!0,label:"ID",name:"id",value:l.id}),e(C,{disabled:!0,fullWidth:!0,label:"Number",name:"number",value:l.number}),e(C,{disabled:!0,fullWidth:!0,label:"Customer name",name:"customer_name",value:l.customer.name}),e(C,{disabled:!0,fullWidth:!0,label:"Date",name:"date",value:a}),e(C,{fullWidth:!0,label:"Address",name:"address",value:l.customer.address1}),e(C,{fullWidth:!0,label:"Country",name:"country",value:l.customer.country}),e(C,{fullWidth:!0,label:"State/Region",name:"state_region",value:l.customer.city}),e(C,{fullWidth:!0,label:"Total Amount",name:"amount",value:l.totalAmount}),e(C,{fullWidth:!0,label:"Status",name:"status",select:!0,SelectProps:{native:!0},value:l.status,children:he.map(u=>e("option",{value:u.value,children:u.label},u.value))})]}),o(f,{alignItems:"center",direction:"row",flexWrap:"wrap",spacing:2,children:[e(R,{color:"primary",onClick:d,size:"small",variant:"contained",children:"Save changes"}),e(R,{color:"inherit",onClick:n,size:"small",children:"Cancel"})]})]})})};G.propTypes={onCancel:h.func,onSave:h.func,order:h.object};const L=t=>{const{container:n,onClose:d,open:l,order:a}=t,[u,r]=c.useState(!1),i=W(p=>p.breakpoints.up("lg")),s=c.useCallback(()=>{r(!0)},[]),b=c.useCallback(()=>{r(!1)},[]);let v=null;return a&&(v=o("div",{children:[o(f,{alignItems:"center",direction:"row",justifyContent:"space-between",sx:{px:3,py:2},children:[e(g,{color:"inherit",variant:"h6",children:a.number}),e(E,{color:"inherit",onClick:d,children:e(O,{children:e(U,{})})})]}),e(w,{sx:{px:3,py:4},children:u?e(G,{onCancel:b,onSave:b,order:a}):e(B,{onApprove:d,onEdit:s,onReject:d,order:a})})]})),i?e(j,{anchor:"right",open:l,PaperProps:{sx:{maxWidth:"100%",width:350}},SlideProps:{container:n},variant:"persistent",children:v}):e(j,{anchor:"right",ModalProps:{container:n},onClose:d,open:l,PaperProps:{sx:{maxWidth:"100%",width:350}},SlideProps:{container:n},variant:"temporary",children:v})};L.propTypes={container:h.any,onClose:h.func,open:h.bool,order:h.object};H("div",{shouldForwardProp:t=>t!=="open"})(({theme:t,open:n})=>({flexGrow:1,overflow:"auto",zIndex:1,[t.breakpoints.up("lg")]:{marginRight:-500},transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),...n&&{[t.breakpoints.up("lg")]:{marginRight:0},transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen})}}));const pe=[{label:"Newest",value:"desc"},{label:"Oldest",value:"asc"}],F=t=>{const{onFiltersChange:n,onSortChange:d,sortDir:l="asc"}=t,a=c.useRef(null),[u,r]=c.useState("all"),[i,s]=c.useState({query:void 0,status:void 0}),b=c.useCallback(()=>{n==null||n(i)},[i,n]);ce(()=>{b()},[i,b]),c.useCallback((m,P)=>{r(P);const x=P==="all"?void 0:P;s(D=>({...D,status:x}))},[]);const v=c.useCallback(m=>{var x;m.preventDefault();const P=((x=a.current)==null?void 0:x.value)||"";s(D=>({...D,query:P}))},[]),p=c.useCallback(m=>{const P=m.target.value;d==null||d(P)},[d]);return e("div",{children:o(f,{alignItems:"center",direction:"row",flexWrap:"wrap",gap:3,sx:{p:3},children:[e(w,{component:"form",onSubmit:v,sx:{flexGrow:1},children:e(_,{defaultValue:"",fullWidth:!0,inputProps:{ref:a},name:"orderNumber",placeholder:"Search by order number",startAdornment:e(z,{position:"start",children:e(O,{children:e($,{})})})})}),e(C,{label:"Sort By",name:"sort",onChange:p,select:!0,SelectProps:{native:!0},value:l,children:pe.map(m=>e("option",{value:m.value,children:m.label},m.value))})]})})};F.propTypes={onFiltersChange:h.func,onSortChange:h.func,sortBy:h.string,sortDir:h.oneOf(["asc","desc"])};const me={complete:"success",pending:"info",canceled:"warning",rejected:"error"},N=t=>{const{count:n=0,items:d=[],onPageChange:l=()=>{},onRowsPerPageChange:a,onSelect:u,page:r=0,rowsPerPage:i=0}=t;return o("div",{children:[e(I,{children:e(M,{children:d.map(s=>{const b=A(Date.parse(s.createdAt),"LLL").toUpperCase(),v=A(Date.parse(s.createdAt),"d"),p=k(s.totalAmount).format(`${s.currency}0,0.00`);return me[s.status],o(T,{hover:!0,onClick:()=>u==null?void 0:u(s.id),sx:{cursor:"pointer"},children:[o(y,{sx:{alignItems:"center",display:"flex"},children:[o(w,{sx:{backgroundColor:m=>m.palette.mode==="dark"?"neutral.800":"neutral.200",borderRadius:2,maxWidth:"fit-content",ml:3,p:1},children:[e(g,{align:"center",variant:"subtitle2",children:b}),e(g,{align:"center",variant:"h6",children:v})]}),o(w,{sx:{ml:2},children:[e(g,{variant:"subtitle2",children:s.number}),o(g,{color:"text.secondary",variant:"body2",children:["Total of ",p]})]})]}),e(y,{align:"right",children:o(E,{component:V,href:"/dashboard/invoices/"+s.id,children:[e(g,{variant:"subtitle2",children:"View Invoice"}),e(O,{children:e(Q,{})})]})})]},s.id)})})}),e(de,{component:"div",count:n,onPageChange:l,onRowsPerPageChange:a,page:r,rowsPerPage:i,rowsPerPageOptions:[5,10,25]})]})};N.propTypes={count:h.number,items:h.array,onPageChange:h.func,onRowsPerPageChange:h.func,onSelect:h.func,page:h.number,rowsPerPage:h.number};const ge=()=>{const[t,n]=c.useState({filters:{query:void 0,status:void 0},page:0,rowsPerPage:5,sortBy:"createdAt",sortDir:"desc",orders:[]});c.useEffect(()=>{axios.post("/api/get_orders",{}).then(r=>{n(i=>({...i,orders:r.data}))})},[]);const d=c.useCallback(r=>{n(i=>({...i,filters:r}))},[]),l=c.useCallback(r=>{n(i=>({...i,sortDir:r}))},[]),a=c.useCallback((r,i)=>{n(s=>({...s,page:i}))},[]),u=c.useCallback(r=>{n(i=>({...i,rowsPerPage:parseInt(r.target.value,10)}))},[]);return{handleFiltersChange:d,handleSortChange:l,handlePageChange:a,handleRowsPerPageChange:u,state:t}},be=t=>{const n=ae(),[d,l]=c.useState({orders:[],ordersCount:0}),a=c.useCallback(async()=>{try{const u=await se.getOrders(t);n()&&l({orders:u.data,ordersCount:u.count})}catch(u){console.error(u)}},[t,n]);return c.useEffect(()=>{a()},[t]),{...d}},ve=(t,n)=>c.useMemo(()=>{if(n)return t.find(d=>d.id===n)},[t,n]),fe=t=>{const{userinfo:n}=t,d=X();c.useEffect(()=>{n.is_admin==0&&d("/dashboard")},[n]);let l={time:new Date().getTime(),value:"email",expire:3e6},a=JSON.stringify(l);localStorage.setItem("time_token",a);const u=c.useRef(null),r=ge(),i=be(r.state),s=Y(),b=ve(i.orders,s.data),v=K();Z();const p=c.useCallback(m=>{if(s.open&&s.data===m){s.handleClose();return}s.handleOpen(m)},[s]);return o(ee,{children:[e(te,{title:"Dashboard: Order List"}),e(w,{component:"main",ref:u,sx:{flexGrow:1,py:8},children:e(re,{maxWidth:v.stretch?!1:"xl",children:e("div",{children:o(w,{ref:u,children:[e(w,{sx:{p:3},children:e(f,{alignItems:"flex-start",direction:"row",justifyContent:"space-between",spacing:4,children:e("div",{children:e(g,{variant:"h4",children:"Orders"})})})}),e(F,{onFiltersChange:r.handleFiltersChange,onSortChange:r.handleSortChange,sortBy:r.state.sortBy,sortDir:r.state.sortDir}),e(ne,{}),e(N,{count:i.ordersCount,items:i.orders,onPageChange:r.handlePageChange,onRowsPerPageChange:r.handleRowsPerPageChange,onSelect:p,page:r.state.page,rowsPerPage:r.state.rowsPerPage}),e(L,{container:u.current,onClose:s.handleClose,open:s.open,order:b})]})})})})]})},Ce=t=>({userinfo:t.profile.userinfo}),je=J(Ce)(fe);export{je as default};
