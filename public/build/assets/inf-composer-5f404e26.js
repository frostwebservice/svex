import{P as u,w as oe,r as i,c9 as le,ci as re,j as d,cj as ce,d as t,ck as ue,at as de,l as M,k as b,aw as pe,q as me,c2 as fe,f as m,G as ge,T as he,bx as U,aK as ye,bp as be,D as xe,ch as x}from"./app-44019970.js";import"./quill-editor-320e3612.js";import{m as ve,D as v,r as Ce,L as we,F as Ie,d as Ee}from"./mail-4c46526d.js";const Se=ve(()=>({noBorder:{border:"none"}})),W=C=>{const{maximize:B=!1,message:_="",onClose:L,onMaximize:je,onMessageChange:w,onMinimize:Te,onSubjectChange:h,onAttach:N,loading:I,onToChange:r,onDisplayChange:p,onInlineImgsChange:D,inlineImgs:K,handleInlineImgsInit:_e,onSubmit:Y,open:E=!1,subject:P="",to:S="",toDisplay:$="",toemail:De="",avatar:F="",userinfo:f}=C,[z,G]=i.useState(v.EditorState.createEmpty()),q=z.getCurrentContent();v.convertToRaw(q);const k=le(),[O,H]=i.useState(),J=JSON.parse(localStorage.getItem("email")),[y,X]=i.useState(0),[j,Q]=i.useState([]);i.useEffect(()=>{E&&axios.post("/api/getoutreachs",{email:J},{}).then(e=>{Q(e.data)})},[E]),i.useEffect(()=>{var c,o;let e="",n="",a=j[y];a&&((c=a[0])==null?void 0:c.detail)==null?(r(""),p("")):a&&((o=a[0])==null?void 0:o.detail)!=null&&(a.map((l,s)=>{s==a.length-1?e+=l.detail.public_email:e+=l.detail.public_email+","}),a.map((l,s)=>{s==a.length-1?n+=l.detail.full_name:n+=l.detail.full_name+","})),r(e),p(n)},[y]);const V=e=>{N(e)},Z=e=>{ae(e.getCurrentContent()),G(e),H(Ee(v.convertToRaw(e.getCurrentContent())))},[g,R]=i.useState(!1);Se();const ee=i.useCallback(e=>{h==null||h(e.target.value)},[h]);i.useCallback(e=>{r==null||r(e.target.value)},[r]),i.useCallback(e=>{p==null||p(e.target.value)},[p]),i.useEffect(()=>{I==!1&&R(!1)},[I]),i.useEffect(()=>{var e,n;if(g){let a="",c="",o=j[y];o&&((e=o[0])==null?void 0:e.detail)==null?(r(""),p("")):o&&((n=o[0])==null?void 0:n.detail)!=null&&(o.map((l,s)=>{s==o.length-1?a+=l.detail.public_email:a+=l.detail.public_email+","}),o.map((l,s)=>{s==o.length-1?c+=l.detail.full_name:c+=l.detail.full_name+","})),r(a),p(c)}else r==null||r("")},[g]);const te=()=>{if(f.is_admin!="1"){if(f.paid=="1"&&f.message_cnt>=50){x.error(`You are trying to send 51th message this month.
 Please upgrade your membership. 
 `+f.time+"days left by renewal date.");return}else if(f.paid=="0"&&f.message_cnt>=5){x.error(`Trial user cannot send over 5 messages .
 Please upgrade your membership.`);return}}if(S==""){x.error("You should input To field.");return}if(P==""){x.error("You should input Subject field.");return}Y()};if(i.useEffect(()=>{w==null||w(O)},[O]),i.useEffect(()=>{_==""&&G(v.EditorState.createEmpty())},[_]),!E)return null;const ae=async e=>{e.getBlockMap().forEach(n=>{n.findEntityRanges(a=>{const c=a.getEntity();return c!==null&&e.getEntity(c).getType()==="IMAGE"},async(a,c)=>{const o=e.getBlockForKey(n.getKey()).getEntityAt(a),s=e.getEntity(o).getData();K.includes(s.src)||(D(s.src),s.src.includes("blob:http")&&axios({method:"get",url:s.src,responseType:"blob"}).then(function(se){var T=new FileReader;T.readAsDataURL(se.data),T.onloadend=function(){var ie=T.result;axios.post("/api/upload_inline",{uri:s.src.split("/")[3],data:ie}).then(A=>{D(s.src+"."+A.data)}).catch(A=>{})}}))})})},ne=e=>{const n={file:e,localsrc:URL.createObjectURL(e)};return new Promise((a,c)=>{a({data:{link:n.localsrc}})})};return re(".rdw-remove-wrapper").on("click",function(){k.handleOpen()}),d(ce,{children:[t(ue,{open:B}),d(de,{sx:{bottom:"10%",display:"flex",flexDirection:"column",height:"80%",outline:"none",position:"fixed",left:"5%",width:"90%",zIndex:1200,overflow:"hidden"},elevation:12,children:[d(M,{sx:{alignItems:"center",display:"flex",px:2,py:1},children:[t(b,{variant:"h6",children:"New Message"}),t(M,{sx:{flexGrow:1}}),t(pe,{onClick:L,children:t(me,{children:t(fe,{})})})]}),d(m,{alignItems:"flex-start",direction:{xs:"column",sm:"row"},justifyContent:"space-between",children:[d(m,{justifyContent:"flex-start",sx:{minWidth:"70%"},children:[d(m,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(b,{sx:{mx:2},children:"To"}),t(ge,{src:F!=""?F:`https://ui-avatars.com/api/?name=${S||""}&background=2970FF&color=fff&rounded=true`}),g==!0?t(he,{sx:{height:53.13},label:"Outreach Group",name:"saved_searchs",value:y,fullWidth:!0,style:{minWidth:200},select:!0,onChange:e=>X(e.target.value),SelectProps:{native:!0},children:j.map((e,n)=>t("option",{value:n,children:n==0?"Favorites":e[0].group_name},e.id))}):t(U,{disableUnderline:!0,readOnly:!0,fullWidth:!0,placeholder:"Input Address To",value:$})]}),d(m,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(b,{sx:{mx:2},children:"Subject"}),t(U,{disableUnderline:!0,fullWidth:!0,onChange:ee,placeholder:"Input Subject",value:P})]})]}),d(m,{alignItems:"center",direction:"row",spacing:1,className:"shower-reach",children:[t(b,{sx:{mx:2,fontWeight:600,fontSize:16},children:"Outreach Group"}),t(ye,{style:{marginRight:20},control:t(be,{checked:g,onChange:()=>R(!g),name:"loading",color:"primary"})})]})]}),t(Ce.Editor,{editorState:z,wrapperClassName:"wrapper-class",editorClassName:"editor-class",toolbarClassName:"toolbar-class",onEditorStateChange:Z,toolbar:{options:["image","link","emoji","remove"],link:{options:["link"],link:{icon:"/assets/icons/link.png"}},emoji:{icon:"/assets/icons/smile.png"},image:{icon:"/assets/icons/image.png",uploadCallback:ne,previewImage:!0},remove:{icon:"/assets/icons/attach.png",title:"Attach"}}}),t(xe,{}),d(m,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,sx:{p:2,mb:2},children:[t(m,{alignItems:"center",direction:"row",spacing:1,sx:{ml:27}}),t("div",{children:t(we,{loading:I,loadingPosition:"center",variant:"contained",onClick:te,children:"Send Email"})})]}),t(Ie,{onClose:k.handleClose,open:k.open,onUpgrade:V})]})]})};W.propTypes={maximize:u.bool,message:u.string,onClose:u.func,onMaximize:u.func,onMessageChange:u.func,onMinimize:u.func,onSubjectChange:u.func,onToChange:u.func,open:u.bool,subject:u.string,to:u.string};const ke=C=>({userinfo:C.profile.userinfo}),Ge=oe(ke)(W);export{Ge as I};
