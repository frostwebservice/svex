import{P as r,w as ue,r as n,c9 as de,ci as _,j as l,cj as pe,d as t,ck as me,at as ge,l as W,k as x,aw as fe,q as he,c2 as be,f as d,G as ye,T as xe,bx as B,aK as ve,bp as Ce,D as we,ch as g}from"./app-44019970.js";import"./quill-editor-320e3612.js";import{m as Ee,D as v,r as Se,L as Ie,F as ke,d as je}from"./mail-4c46526d.js";const Te=Ee(()=>({noBorder:{border:"none"}})),L=C=>{const{maximize:N=!1,message:D="",onClose:K,onMaximize:De,onMessageChange:w,onMinimize:Pe,onSubjectChange:f,onAttach:Y,loading:E,onToChange:i,onDisplayChange:h,onInlineImgsChange:P,inlineImgs:$,handleInlineImgsInit:Me,onSubmit:q,open:H=!1,subject:M="",to:F="",toDisplay:S="",toemail:Fe="",avatar:z="",userinfo:p}=C,[A,G]=n.useState(v.EditorState.createEmpty()),J=A.getCurrentContent();v.convertToRaw(J);const I=de(),[R,V]=n.useState(),X=JSON.parse(localStorage.getItem("email")),[b,Q]=n.useState(0),[k,Z]=n.useState([]),[j,ee]=n.useState([]);n.useEffect(()=>{axios.post("/api/getoutreachs",{email:X},{}).then(e=>{Z(e.data)})},[]),n.useEffect(()=>{axios.post("/api/get_possible_infs",{}).then(e=>{ee(e.data)}).catch(e=>{})},[]),n.useEffect(()=>{var a,o;let e="",s=k[b];s&&((a=s[0])==null?void 0:a.detail)==null?i(""):s&&((o=s[0])==null?void 0:o.detail)!=null&&s.map((u,y)=>{y==s.length-1?e+=u.detail.public_email:e+=u.detail.public_email+","}),i(e)},[b]);const te=e=>{Y(e)},se=e=>{oe(e.getCurrentContent()),G(e),V(je(v.convertToRaw(e.getCurrentContent())))},[c,O]=n.useState(!1);Te();const ae=n.useCallback(e=>{f==null||f(e.target.value)},[f]);n.useCallback(e=>{i==null||i(e.target.value)},[i]);const ne=n.useCallback(e=>{h==null||h(e.target.value);let s=j.filter(a=>a.username==e.target.value).length>0?j.filter(a=>a.username==e.target.value)[0].public_email:"";i==null||i(s)},[h]);n.useEffect(()=>{E==!1&&O(!1)},[E]),n.useEffect(()=>{var e,s;if(c){let a="",o=k[b];o&&((e=o[0])==null?void 0:e.detail)==null?i(""):o&&((s=o[0])==null?void 0:s.detail)!=null&&o.map((u,y)=>{y==o.length-1?a+=u.detail.public_email:a+=u.detail.public_email+","}),i(a)}else i==null||i("")},[c]);const ie=()=>{if(p.is_admin!="1"){if(p.paid=="1"&&p.message_cnt>=50){g.error(`You are trying to send 51th message this month.
 Please upgrade your membership. 
 `+p.time+"days left by renewal date.");return}else if(p.paid=="0"&&p.message_cnt>=5){g.error(`Trial user cannot send over 5 messages .
 Please upgrade your membership.`);return}}if(c&&F==""){if(c){g.error("This outreach group has no influencers");return}g.error("You should input To field.");return}if(M==""){g.error("You should input Subject field.");return}if(!c&&F==""){g.error("You should send mail to known address of influencers"),i("");return}q()};if(n.useEffect(()=>{w==null||w(R)},[R]),n.useEffect(()=>{D==""&&G(v.EditorState.createEmpty())},[D]),!H)return null;const oe=async e=>{e.getBlockMap().forEach(s=>{s.findEntityRanges(a=>{const o=a.getEntity();return o!==null&&e.getEntity(o).getType()==="IMAGE"},async(a,o)=>{const u=e.getBlockForKey(s.getKey()).getEntityAt(a),m=e.getEntity(u).getData();$.includes(m.src)||(P(m.src),m.src.includes("blob:http")&&axios({method:"get",url:m.src,responseType:"blob"}).then(function(le){var T=new FileReader;T.readAsDataURL(le.data),T.onloadend=function(){var ce=T.result;axios.post("/api/upload_inline",{uri:m.src.split("/")[3],data:ce}).then(U=>{P(m.src+"."+U.data)}).catch(U=>{})}}))})})},re=e=>{const s={file:e,localsrc:URL.createObjectURL(e)};return new Promise((a,o)=>{a({data:{link:s.localsrc}})})};return _(".rdw-remove-wrapper").on("click",function(){I.handleOpen()}),_(".suggestion input").on("focus",function(){_("#suggestion")[0].style.display="none"}),l(pe,{children:[t(me,{open:N}),l(ge,{sx:{bottom:"10%",display:"flex",flexDirection:"column",height:"80%",outline:"none",position:"fixed",left:"5%",width:"90%",zIndex:1200,overflow:"hidden"},elevation:12,children:[l(W,{sx:{alignItems:"center",display:"flex",px:2,py:1},children:[t(x,{variant:"h6",children:"New Message"}),t(W,{sx:{flexGrow:1}}),t(fe,{onClick:K,children:t(he,{children:t(be,{})})})]}),l(d,{alignItems:"flex-start",direction:{xs:"column",sm:"row"},justifyContent:"space-between",children:[l(d,{justifyContent:"flex-start",sx:{minWidth:"200px"},children:[l(d,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(x,{sx:{mx:2},children:"To"}),t(ye,{src:z!=""?z:`https://ui-avatars.com/api/?name=${S||""}&background=2970FF&color=fff&rounded=true`}),c==!0?t(xe,{sx:{height:53.13},label:"Outreach Group",name:"saved_searchs",value:b,fullWidth:!0,style:{minWidth:200},select:!0,onChange:e=>Q(e.target.value),SelectProps:{native:!0},children:k.map((e,s)=>t("option",{value:s,children:s==0?"Favorites":e[0].group_name},e.id))}):t(B,{disableUnderline:!0,fullWidth:!0,onChange:ne,placeholder:"Input Address To",value:S,list:"suggestion",className:"suggestion",inputProps:{list:"suggestion"}}),t("datalist",{id:"suggestion",children:j.map((e,s)=>t("option",{value:e.username,children:e.username},s))})]}),l(d,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(x,{sx:{mx:2},children:"Subject"}),t(B,{disableUnderline:!0,fullWidth:!0,onChange:ae,placeholder:"Input Subject",value:M})]})]}),l(d,{alignItems:"center",direction:"row",spacing:1,children:[t(x,{sx:{mx:2,fontWeight:600,fontSize:16},children:"Outreach Group"}),t(ve,{style:{marginRight:20},control:t(Ce,{checked:c,onChange:()=>O(!c),name:"loading",color:"primary"})})]})]}),t(Se.Editor,{editorState:A,wrapperClassName:"wrapper-class",editorClassName:"editor-class",toolbarClassName:"toolbar-class",onEditorStateChange:se,toolbar:{options:["image","link","emoji","remove"],link:{options:["link"],link:{icon:"/assets/icons/link.png"}},emoji:{icon:"/assets/icons/smile.png"},image:{icon:"/assets/icons/image.png",uploadCallback:re,previewImage:!0},remove:{icon:"/assets/icons/attach.png",title:"Attach"}}}),t(we,{}),l(d,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,sx:{p:2,mb:2},children:[t(d,{alignItems:"center",direction:"row",spacing:1,sx:{ml:27}}),t("div",{children:t(Ie,{loading:E,loadingPosition:"center",variant:"contained",onClick:ie,children:"Send Email"})})]}),t(ke,{onClose:I.handleClose,open:I.open,onUpgrade:te})]})]})};L.propTypes={maximize:r.bool,message:r.string,onClose:r.func,onMaximize:r.func,onMessageChange:r.func,onMinimize:r.func,onSubjectChange:r.func,onToChange:r.func,open:r.bool,subject:r.string,to:r.string};const _e=C=>({userinfo:C.profile.userinfo}),Re=ue(_e)(L);export{Re as M};
