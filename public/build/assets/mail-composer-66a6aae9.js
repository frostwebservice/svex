import{P as r,w as ue,r as s,c9 as de,ci as _,j as l,cj as pe,d as t,ck as me,at as ge,l as U,k as v,aw as fe,q as he,c2 as be,f as d,G as ye,T as xe,bx as W,aK as ve,bp as Ce,D as we,ch as g}from"./app-f8174623.js";import"./quill-editor-ab086f5b.js";import{m as Se,D as C,r as Ee,L as Ie,F as ke,d as je}from"./mail-c9c49be3.js";const Te=Se(()=>({noBorder:{border:"none"}})),B=w=>{const{maximize:L=!1,message:D="",onClose:N,onMaximize:De,onMessageChange:S,onMinimize:Pe,onSubjectChange:h,onAttach:K,loading:E,onToChange:a,onDisplayChange:b,onInlineImgsChange:P,inlineImgs:Y,handleInlineImgsInit:Me,onSubmit:$,open:q=!1,subject:M="",to:H="",toDisplay:f="",toemail:Fe="",avatar:F="",userinfo:p}=w,[z,A]=s.useState(C.EditorState.createEmpty()),J=z.getCurrentContent();C.convertToRaw(J);const I=de(),[G,X]=s.useState(),Q=JSON.parse(localStorage.getItem("email")),[y,Z]=s.useState(0),[k,V]=s.useState([]),[j,ee]=s.useState([]);s.useEffect(()=>{axios.post("/api/getoutreachs",{email:Q},{}).then(e=>{V(e.data)})},[]),s.useEffect(()=>{axios.post("/api/get_possible_infs",{}).then(e=>{ee(e.data)}).catch(e=>{})},[]),s.useEffect(()=>{var o,i;let e="",n=k[y];n&&((o=n[0])==null?void 0:o.detail)==null?a(""):n&&((i=n[0])==null?void 0:i.detail)!=null&&n.map((u,x)=>{x==n.length-1?e+=u.detail.public_email:e+=u.detail.public_email+","}),a(e)},[y]);const te=e=>{K(e)},ne=e=>{oe(e.getCurrentContent()),A(e),X(je(C.convertToRaw(e.getCurrentContent())))},[c,R]=s.useState(!1);Te();const se=s.useCallback(e=>{h==null||h(e.target.value)},[h]);s.useCallback(e=>{a==null||a(e.target.value)},[a]);const ae=s.useCallback(e=>{b==null||b(e.target.value)},[b]);s.useEffect(()=>{E==!1&&R(!1)},[E]),s.useEffect(()=>{var e,n;if(c){let o="",i=k[y];i&&((e=i[0])==null?void 0:e.detail)==null?a(""):i&&((n=i[0])==null?void 0:n.detail)!=null&&i.map((u,x)=>{x==i.length-1?o+=u.detail.public_email:o+=u.detail.public_email+","}),a(o)}else a==null||a("")},[c]);const ie=()=>{if(p.is_admin!="1"){if(p.paid=="1"&&p.message_cnt>=50){g.error(`You are trying to send 51th message this month.
 Please upgrade your membership. 
 `+p.time+"days left by renewal date.");return}else if(p.paid=="0"&&p.message_cnt>=5){g.error(`Trial user cannot send over 5 messages .
 Please upgrade your membership.`);return}}if(c&&H==""){if(c){g.error("This outreach group has no influencers");return}g.error("You should input To field.");return}if(M==""){g.error("You should input Subject field.");return}if(!c){var e=j.filter(n=>n.username==f).length>0?j.filter(n=>n.username==f)[0].public_email:"";if(a==null||a(e),e==""){g.error("You should send mail to known address of influencers"),a("");return}}$(e)};if(s.useEffect(()=>{S==null||S(G)},[G]),s.useEffect(()=>{D==""&&A(C.EditorState.createEmpty())},[D]),!q)return null;const oe=async e=>{e.getBlockMap().forEach(n=>{n.findEntityRanges(o=>{const i=o.getEntity();return i!==null&&e.getEntity(i).getType()==="IMAGE"},async(o,i)=>{const u=e.getBlockForKey(n.getKey()).getEntityAt(o),m=e.getEntity(u).getData();Y.includes(m.src)||(P(m.src),m.src.includes("blob:http")&&axios({method:"get",url:m.src,responseType:"blob"}).then(function(le){var T=new FileReader;T.readAsDataURL(le.data),T.onloadend=function(){var ce=T.result;axios.post("/api/upload_inline",{uri:m.src.split("/")[3],data:ce}).then(O=>{P(m.src+"."+O.data)}).catch(O=>{})}}))})})},re=e=>{const n={file:e,localsrc:URL.createObjectURL(e)};return new Promise((o,i)=>{o({data:{link:n.localsrc}})})};return _(".rdw-remove-wrapper").on("click",function(){I.handleOpen()}),_(".suggestion input").on("focus",function(){_("#suggestion")[0].style.display="none"}),l(pe,{children:[t(me,{open:L}),l(ge,{sx:{bottom:"10%",display:"flex",flexDirection:"column",height:"80%",outline:"none",position:"fixed",left:"5%",width:"90%",zIndex:1200,overflow:"hidden"},elevation:12,children:[l(U,{sx:{alignItems:"center",display:"flex",px:2,py:1},children:[t(v,{variant:"h6",children:"New Message"}),t(U,{sx:{flexGrow:1}}),t(fe,{onClick:N,children:t(he,{children:t(be,{})})})]}),l(d,{alignItems:"flex-start",direction:{xs:"column",sm:"row"},justifyContent:"space-between",children:[l(d,{justifyContent:"flex-start",sx:{minWidth:"200px"},children:[l(d,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(v,{sx:{mx:2},children:"To"}),t(ye,{src:F!=""?F:`https://ui-avatars.com/api/?name=${f||""}&background=2970FF&color=fff&rounded=true`}),c==!0?t(xe,{sx:{height:53.13},label:"Outreach Group",name:"saved_searchs",value:y,fullWidth:!0,style:{minWidth:200},select:!0,onChange:e=>Z(e.target.value),SelectProps:{native:!0},children:k.map((e,n)=>t("option",{value:n,children:n==0?"Favorites":e[0].group_name},e.id))}):t(W,{disableUnderline:!0,fullWidth:!0,onChange:ae,placeholder:"Input Address To",value:f,list:"suggestion",className:"suggestion",inputProps:{list:"suggestion"}}),t("datalist",{id:"suggestion",children:j.map((e,n)=>t("option",{value:e.username,children:e.username},n))})]}),l(d,{alignItems:"center",direction:"row",spacing:1,sx:{py:2},children:[t(v,{sx:{mx:2},children:"Subject"}),t(W,{disableUnderline:!0,fullWidth:!0,onChange:se,placeholder:"Input Subject",value:M})]})]}),l(d,{alignItems:"center",direction:"row",spacing:1,children:[t(v,{sx:{mx:2,fontWeight:600,fontSize:16},children:"Outreach Group"}),t(ve,{style:{marginRight:20},control:t(Ce,{checked:c,onChange:()=>R(!c),name:"loading",color:"primary"})})]})]}),t(Ee.Editor,{editorState:z,wrapperClassName:"wrapper-class",editorClassName:"editor-class",toolbarClassName:"toolbar-class",onEditorStateChange:ne,toolbar:{options:["image","link","emoji","remove"],link:{options:["link"],link:{icon:"/assets/icons/link.png"}},emoji:{icon:"/assets/icons/smile.png"},image:{icon:"/assets/icons/image.png",uploadCallback:re,previewImage:!0},remove:{icon:"/assets/icons/attach.png",title:"Attach"}}}),t(we,{}),l(d,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:3,sx:{p:2,mb:2},children:[t(d,{alignItems:"center",direction:"row",spacing:1,sx:{ml:27}}),t("div",{children:t(Ie,{loading:E,loadingPosition:"center",variant:"contained",onClick:ie,children:"Send Email"})})]}),t(ke,{onClose:I.handleClose,open:I.open,onUpgrade:te})]})]})};B.propTypes={maximize:r.bool,message:r.string,onClose:r.func,onMaximize:r.func,onMessageChange:r.func,onMinimize:r.func,onSubjectChange:r.func,onToChange:r.func,open:r.bool,subject:r.string,to:r.string};const _e=w=>({userinfo:w.profile.userinfo}),Re=ue(_e)(B);export{Re as M};
