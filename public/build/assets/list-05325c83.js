import{r as i,_ as J,K as I,d as e,aq as oe,bE as G,cw as V,cB as W,cC as _,ap as re,P as b,j as s,f as m,k as h,aw as X,q as F,c2 as ae,bm as se,bn as ie,bo as ce,h as q,T as B,l as A,aY as Y,bP as le,aK as j,m as de,bp as $,cD as K,w as ee,aM as x,C as M,e as E,G as R,b1 as ue,b9 as N,R as Q,aN as pe,o as he,aS as ge,c as fe,F as me,S as ve,D as be,aL as Pe,B as ye,u as Ce}from"./app-99b40063.js";import{a as ke}from"./apply-pagination-03aa54c3.js";import{u as we,d as De,D as xe,M as Ie}from"./MobileDatePicker-35475cfe.js";import{k as Se,h as Te,i as Me,K as Le,C as Re}from"./PureDateInput-a459f35a.js";import{C as Fe}from"./Clock-dc92dd41.js";import{R as je}from"./Receipt-7c58de35.js";import{S as Ee}from"./severity-pill-20cd942c.js";import{g as Ae}from"./get-initials-d1c6cec7.js";import{T as U,a as Z,b as Ge,c as T}from"./TableRow-3f98919f.js";import{T as Oe}from"./TablePagination-7695cf01.js";import"./Grid-6b2d4e9e.js";import"./createTheme-4d33d0a4.js";import"./DialogActions-9b908a5c.js";import"./LastPage-ea44aac4.js";const Ve=["onChange","PopperProps","PaperProps","ToolbarComponent","TransitionComponent","value","components","componentsProps"],We=i.forwardRef(function(n,t){const c=we(n,"MuiDesktopDatePicker"),p=Se(c)!==null,{pickerProps:o,inputProps:l,wrapperProps:u}=Te(c,De),{PopperProps:d,PaperProps:g,ToolbarComponent:w=xe,TransitionComponent:v,components:P,componentsProps:y}=c,C=J(c,Ve),k=I({},l,C,{components:P,componentsProps:y,ref:t,validationError:p});return e(Me,I({},u,{DateInputProps:k,KeyboardDateInputComponent:Le,PopperProps:d,PaperProps:g,TransitionComponent:v,components:P,componentsProps:y,children:e(Re,I({},o,{autoFocus:!0,toolbarTitle:c.label||c.toolbarTitle,ToolbarComponent:w,DateInputProps:k,components:P,componentsProps:y},C))}))}),_e=["desktopModeMediaQuery","DialogProps","PopperProps","TransitionComponent"],z=i.forwardRef(function(n,t){const c=oe({props:n,name:"MuiDatePicker"}),{desktopModeMediaQuery:p="@media (pointer: fine)",DialogProps:o,PopperProps:l,TransitionComponent:u}=c,d=J(c,_e);return G(p,{defaultMatches:!0})?e(We,I({ref:t,PopperProps:l,TransitionComponent:u},d)):e(Ie,I({ref:t,DialogProps:o},d))});var qe=function(n){return e("svg",I({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},n,{children:e("path",{fill:"#fff",fillOpacity:.01,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4.44c0-.504 0-.756.098-.9486a.9.9 0 0 1 .3934-.3933C3.684 3 3.936 3 4.44 3h15.12c.504 0 .7561 0 .9486.098a.9003.9003 0 0 1 .3933.3934C21 3.684 21 3.936 21 4.44v.6024c0 .242 0 .363-.0296.4754a.9013.9013 0 0 1-.1274.2792c-.0657.096-.1571.1752-.3399.3337l-5.7562 4.9887c-.1828.1584-.2742.2376-.3399.3336a.9015.9015 0 0 0-.1274.2792c-.0296.1125-.0296.2334-.0296.4753v4.705c0 .176 0 .264-.0284.3401a.4503.4503 0 0 1-.119.1758c-.0601.0546-.1418.0873-.3052.1526l-3.06 1.224c-.3308.1324-.4962.1985-.629.1709a.45.45 0 0 1-.2835-.1919c-.0749-.1131-.0749-.2912-.0749-.6475v-5.929c0-.2419 0-.3628-.0296-.4753a.9003.9003 0 0 0-.1274-.2792c-.0657-.096-.157-.1752-.3399-.3336L3.4969 6.1306c-.1828-.1584-.2742-.2376-.3399-.3336a.9001.9001 0 0 1-.1274-.2792C3 5.4053 3 5.2844 3 5.0424V4.44Z"})}))};class Be{getInvoices(n={}){const{filters:t,page:c,rowsPerPage:p,invoices:o}=n;let l=V(o),u=l.length;return typeof t<"u"&&(l=l.filter(d=>!(typeof t.query<"u"&&t.query!==""&&!d.number.toLowerCase().includes(t.query.toLowerCase())||typeof t.startDate<"u"&&(typeof d.issueDate>"u"||!(W(d.issueDate)>=_(t.startDate)))||typeof t.endDate<"u"&&(typeof d.issueDate>"u"||!(_(d.issueDate)<=W(t.endDate)))||typeof t.customers<"u"&&t.customers.length>0&&!t.customers.includes(d.customer.name)||typeof t.status<"u"&&d.status!==t.status)),u=l.length),typeof c<"u"&&typeof p<"u"&&(l=ke(l,c,p)),Promise.resolve({data:l,count:u})}getInvoice(n={}){const{invoice:t}=n;return V(t)}}const $e=new Be,Ke=re("div",{shouldForwardProp:r=>r!=="open"})(({theme:r,open:n})=>({flexGrow:1,overflow:"auto",paddingLeft:r.spacing(3),paddingRight:r.spacing(3),paddingTop:r.spacing(8),paddingBottom:r.spacing(8),zIndex:1,[r.breakpoints.up("lg")]:{marginLeft:-380},transition:r.transitions.create("margin",{easing:r.transitions.easing.sharp,duration:r.transitions.duration.leavingScreen}),...n&&{[r.breakpoints.up("lg")]:{marginLeft:0},transition:r.transitions.create("margin",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.enteringScreen})}})),te=r=>{const{container:n,filters:t={},group:c,onClose:p,onFiltersChange:o,onGroupChange:l,open:u,...d}=r,[g,w]=i.useState([]);i.useEffect(()=>{axios.post("/api/get_customers",{}).then(a=>{w(a.data)})},[]);const v=i.useRef(null),P=G(a=>a.breakpoints.up("lg")),y=i.useCallback(a=>{var f;a.preventDefault(),o==null||o({...t,query:((f=v.current)==null?void 0:f.value)||""})},[t,o]),C=i.useCallback(a=>{const f={...t,startDate:a||void 0};f.endDate&&a&&a>f.endDate&&(f.endDate=a),o==null||o(f)},[t,o]),k=i.useCallback(a=>{const f={...t,endDate:a||void 0};f.startDate&&a&&a<f.startDate&&(f.startDate=a),o==null||o(f)},[t,o]),S=i.useCallback(a=>{let f;a.target.checked?f=[...t.customers||[],a.target.value]:f=(t.customers||[]).filter(L=>L!==a.target.value),o==null||o({...t,customers:f})},[t,o]),D=i.useCallback(a=>{o==null||o({...t,status:a.target.checked?"paid":void 0})},[t,o]),O=s("div",{children:[s(m,{alignItems:"center",justifyContent:"space-between",direction:"row",sx:{p:3},children:[e(h,{variant:"h5",children:"Filters"}),e(X,{onClick:p,children:e(F,{children:e(ae,{})})})]}),s(m,{spacing:3,sx:{p:3},children:[e("form",{onSubmit:y,children:e(se,{defaultValue:"",fullWidth:!0,inputProps:{ref:v},placeholder:"Invoice number",startAdornment:e(ie,{position:"start",children:e(F,{children:e(ce,{})})})})}),s("div",{children:[e(q,{sx:{display:"block",mb:2},children:"Issue date"}),s(m,{spacing:2,children:[e(z,{inputFormat:"dd/MM/yyyy",label:"From",onChange:C,renderInput:a=>e(B,{...a}),value:t.startDate||null}),e(z,{inputFormat:"dd/MM/yyyy",label:"To",onChange:k,renderInput:a=>e(B,{...a}),value:t.endDate||null})]})]}),s("div",{children:[e(q,{sx:{display:"block",mb:2},children:"From customer"}),e(A,{sx:{backgroundColor:a=>a.palette.mode==="dark"?"neutral.800":"neutral.50",borderColor:"divider",borderRadius:1,borderStyle:"solid",borderWidth:1},children:e(Y,{sx:{maxHeight:200},children:e(le,{sx:{py:1,px:1.5},children:g.map(a=>{var L;const f=(L=t.customers)==null?void 0:L.includes(a);return e(j,{control:e(de,{checked:f,onChange:S}),label:a,value:a},a)})})})})]}),e(j,{control:e($,{checked:t.status==="paid",onChange:D}),label:"Paid only"}),e(j,{control:e($,{checked:c,onChange:l}),label:"Group by status"})]})]});return P?e(K,{anchor:"left",open:u,PaperProps:{elevation:16,sx:{border:"none",borderRadius:2.5,overflow:"hidden",position:"relative",width:380}},SlideProps:{container:n},variant:"persistent",sx:{p:3},...d,children:O}):e(K,{anchor:"left",hideBackdrop:!0,ModalProps:{container:n,sx:{pointerEvents:"none",position:"absolute"}},onClose:p,open:u,PaperProps:{sx:{maxWidth:"100%",width:380,pointerEvents:"auto",position:"absolute"}},SlideProps:{container:n},variant:"temporary",...d,children:O})};te.propTypes={container:b.any,filters:b.object,onClose:b.func,onFiltersChange:b.func,open:b.bool};var Ne=function(n){return s("svg",I({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none"},n,{children:[e("path",{fill:"#fff",fillOpacity:.01,d:"M4 7.8c0-1.6802 0-2.5202.327-3.162a3 3 0 0 1 1.311-1.311C6.2798 3 7.1198 3 8.8 3h6.4c1.6802 0 2.5202 0 3.162.327a2.9997 2.9997 0 0 1 1.311 1.311C20 5.2798 20 6.1198 20 7.8V21l-2.75-2-2.5 2L12 19l-2.75 2-2.5-2L4 21V7.8Z"}),e("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m9 10.5 2 2L15.5 8M20 21V7.8c0-1.6802 0-2.5202-.327-3.162a2.9997 2.9997 0 0 0-1.311-1.311C17.7202 3 16.8802 3 15.2 3H8.8c-1.6802 0-2.5202 0-3.162.327a3 3 0 0 0-1.311 1.311C4 5.2798 4 6.1198 4 7.8V21l2.75-2 2.5 2L12 19l2.75 2 2.5-2L20 21Z"})]}))};const Qe=r=>{const{count:n,items:t,userinfo:c}=r;i.useState(0);const[p,o]=i.useState(0);return i.useState(!1),i.useEffect(()=>{},[c]),i.useEffect(()=>{const l=t.reduce((u,d)=>u+Number(d.totalAmount),0);o(l.toFixed(2))},[t]),e("div",{children:s(x,{container:!0,spacing:3,children:[e(x,{xs:12,md:6,lg:4,children:e(M,{children:e(E,{children:s(m,{alignItems:"center",direction:"row",spacing:2,children:[e(R,{sx:{height:48,width:48},children:e(je,{})}),s("div",{children:[e(h,{color:"text.secondary",variant:"body2",children:"Total"}),s(h,{variant:"h6",children:["$",p]}),s(h,{color:"text.secondary",variant:"body2",children:["from ",n," invoices"]})]})]})})})}),e(x,{xs:12,md:6,lg:4,children:e(M,{children:e(E,{children:s(m,{alignItems:"center",direction:"row",spacing:2,children:[e(R,{sx:{backgroundColor:"success.lightest",color:"success.main",height:48,width:48},children:e(Ne,{})}),s("div",{children:[e(h,{color:"text.secondary",variant:"body2",children:"Paid"}),s(h,{variant:"h6",children:["$",p]}),s(h,{color:"text.secondary",variant:"body2",children:["from ",n," invoices"]})]})]})})})}),e(x,{xs:12,md:6,lg:4,children:e(M,{children:e(E,{children:s(m,{alignItems:"center",direction:"row",spacing:2,children:[e(R,{sx:{backgroundColor:"warning.lightest",color:"warning.main",height:48,width:48},children:e(Fe,{})}),s("div",{children:[e(h,{color:"text.secondary",variant:"body2",children:"Pending"}),e(h,{variant:"h6",children:"$0.00"}),e(h,{color:"text.secondary",variant:"body2",children:"from 0 invoices"})]})]})})})})]})})},Ue=r=>({userinfo:r.profile.userinfo}),Ze=ee(Ue)(Qe),ze=r=>r.reduce((n,t)=>{const{status:c}=t;return{...n,[c]:[...n[c],t]}},{canceled:[],paid:[],pending:[]}),He={canceled:"error",paid:"success",pending:"warning"},H=r=>{const{invoice:n,...t}=r,c=He[n.status],p=ue(n.totalAmount).format("0,0.00"),o=n.issueDate&&N(Date.parse(n.issueDate),"dd/MM/yyyy"),l=n.dueDate&&N(Date.parse(n.dueDate),"dd/MM/yyyy");return s(Ge,{sx:{"&:last-child td, &:last-child th":{border:0}},...t,children:[e(T,{width:"25%",children:s(m,{alignItems:"center",direction:"row",spacing:2,component:Q,href:"/dashboard/invoices/"+n.id,sx:{display:"inline-flex",textDecoration:"none",whiteSpace:"nowrap"},children:[e(R,{sx:{height:42,width:42},children:Ae(n.customer.name)}),s("div",{children:[e(h,{color:"text.primary",variant:"subtitle2",children:n.number}),e(h,{color:"text.secondary",variant:"body2",children:n.customer.name})]})]})}),e(T,{children:s(h,{variant:"subtitle2",children:[n.currency,p]})}),s(T,{children:[e(h,{variant:"subtitle2",children:"Issued"}),e(h,{color:"text.secondary",variant:"body2",children:o})]}),s(T,{children:[e(h,{variant:"subtitle2",children:"Due"}),e(h,{color:"text.secondary",variant:"body2",children:l})]}),e(T,{align:"right",children:e(Ee,{color:c,children:n.status})}),e(T,{align:"right",children:e(X,{component:Q,href:"/dashboard/invoices/"+n.id,children:e(F,{children:e(pe,{})})})})]})},ne=r=>{const{group:n=!1,items:t=[],count:c=0,onPageChange:p=()=>{},onRowsPerPageChange:o,page:l=0,rowsPerPage:u=0}=r;let d;if(n){const g=ze(t),w=Object.keys(g);d=e(m,{spacing:6,children:w.map(v=>{const P=v.charAt(0).toUpperCase()+v.slice(1),y=g[v].length,C=g[v],k=C.length>0;return s(m,{spacing:2,children:[s(h,{color:"text.secondary",variant:"h6",children:[P," (",y,")"]}),k&&e(M,{children:e(Y,{children:e(U,{sx:{minWidth:600},children:e(Z,{children:C.map(S=>e(H,{invoice:S},S.id))})})})})]},P)})})}else d=e(M,{children:e(U,{children:e(Z,{children:t.map(g=>e(H,{invoice:g},g.id))})})});return s(m,{spacing:4,children:[d,e(Oe,{component:"div",count:c,onPageChange:p,onRowsPerPageChange:o,page:l,rowsPerPage:u,rowsPerPageOptions:[5,10,25]})]})};ne.propTypes={count:b.number,group:b.bool,items:b.array,onPageChange:b.func,onRowsPerPageChange:b.func,page:b.number,rowsPerPage:b.number};const Je=()=>{const[r,n]=i.useState({filters:{customers:[],endDate:void 0,query:"",startDate:void 0},page:0,rowsPerPage:5,invoices:[]});i.useEffect(()=>{axios.post("/api/get_invoices",{}).then(o=>{n(l=>({...l,invoices:o.data}))})},[]);const t=i.useCallback(o=>{n(l=>({...l,filters:o,page:0}))},[]),c=i.useCallback((o,l)=>{n(u=>({...u,page:l}))},[]),p=i.useCallback(o=>{n(l=>({...l,rowsPerPage:parseInt(o.target.value,10)}))},[]);return{handleFiltersChange:t,handlePageChange:c,handleRowsPerPageChange:p,state:r}},Xe=r=>{const n=Ce(),[t,c]=i.useState({invoices:[],invoicesCount:0}),p=i.useCallback(async()=>{try{const o=await $e.getInvoices(r);n()&&c({invoices:o.data,invoicesCount:o.count})}catch(o){console.error(o)}},[r,n]);return i.useEffect(()=>{p()},[r]),{...t}},Ye=r=>{const{userinfo:n}=r,t=he();i.useEffect(()=>{n.is_admin==0&&t("/dashboard")},[n]);let c={time:new Date().getTime(),value:"email",expire:3e6},p=JSON.stringify(c);localStorage.setItem("time_token",p);const o=i.useRef(null),l=G(D=>D.breakpoints.up("lg")),u=Je(),d=Xe(u.state),[g,w]=i.useState(!0),[v,P]=i.useState(l),y=ge();fe();const C=i.useCallback(D=>{w(D.target.checked)},[]),k=i.useCallback(()=>{P(D=>!D)},[]),S=i.useCallback(()=>{P(!1)},[]);return s(me,{children:[e(ve,{title:"Dashboard: Invoice List"}),e(be,{}),e(A,{component:"main",sx:{flexGrow:1,py:8},children:e(Pe,{maxWidth:y.stretch?!1:"xl",children:e(A,{ref:o,children:s(x,{container:!0,spacing:3,children:[e(x,{xs:12,lg:4,children:e(te,{container:o.current,filters:u.state.filters,group:g,onFiltersChange:u.handleFiltersChange,onClose:S,onGroupChange:C,open:v})}),e(x,{xs:12,lg:8,children:e(Ke,{open:v,children:s(m,{spacing:4,children:[s(m,{alignItems:"flex-start",direction:"row",justifyContent:"space-between",spacing:3,children:[e("div",{children:e(h,{variant:"h4",children:"Invoices"})}),e(m,{alignItems:"center",direction:"row",spacing:1,children:e(ye,{color:"inherit",startIcon:e(F,{children:e(qe,{})}),onClick:k,children:"Filters"})})]}),e(Ze,{items:d.invoices,count:d.invoicesCount}),e(ne,{count:d.invoicesCount,group:g,items:d.invoices,onPageChange:u.handlePageChange,onRowsPerPageChange:u.handleRowsPerPageChange,page:u.state.page,rowsPerPage:u.state.rowsPerPage})]})})})]})})})})]})},et=r=>({userinfo:r.profile.userinfo}),ft=ee(et)(Ye);export{ft as default};
